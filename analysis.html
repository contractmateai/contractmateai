<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>SignSense — Analysis</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <style>
    :root{
      --bg:#0e0c13;
      --card:#1c1b22;
      --border:#3b3b3b;            /* hairline card border */
      --white:#ffffff;
      --muted:#bdbdbd;
      --green:#00ff65;
      --orange:#df911a;
      --red:#fe0000;
      --black:#000000;
      --radius:21px;
      --gap:18px;
      --sidebar:300px;             /* larger sidebar */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--white);font:400 16px/1.7 Inter,system-ui,Segoe UI,Roboto,Arial}

    .layout{display:grid;grid-template-columns:var(--sidebar) 1fr;min-height:100vh}

    /* ===== SIDEBAR ===== */
    .sidebar{
      background:#0f0e14;border-right:1px solid var(--border);
      padding:12px 16px 16px;position:sticky;top:0;height:100vh;display:flex;flex-direction:column;gap:16px
    }
    .brand{padding:0 2px}
    .brand a{
      display:flex;align-items:center;gap:12px;height:52px;       /* aligns with topbar height */
      text-decoration:none;color:var(--white);
    }
    .brand img{width:34px;height:34px}
    .brand span{font-size:22px;color:var(--white);font-weight:400}

    .nav{display:flex;flex-direction:column;gap:10px;margin-top:6px}
    .nav a{
      text-decoration:none;color:var(--muted);display:flex;align-items:center;gap:14px;
      padding:14px 16px;border-radius:16px;border:1px solid transparent;transition:border-color .2s ease;
      font-size:17px;
    }
    .nav a img.icon{width:26px;height:26px;opacity:.95}
    .nav a img.arr{width:18px;height:18px;opacity:.9}
    .nav a.active{background:#181620;border:1px solid var(--border);color:var(--white)}
    .nav a:hover{background:transparent;border-color:var(--border);color:var(--white)}
    .nav a.active:hover{background:#181620;border-color:var(--border)} /* no change on active */

    .push{flex:1}
    .end-only{display:none} /* will show at page end */

    .legal{color:var(--muted);font-size:15px;line-height:1.6}
    .footer-sep{height:1px;background:var(--border);margin:10px 0}
    .copy{color:var(--muted);font-size:15px}
    .copy2{color:var(--muted);font-size:15px;margin-top:6px}

    /* ===== MAIN ===== */
    .main{padding:0 20px 140px;display:grid;grid-template-rows:auto 1fr;gap:var(--gap)}
    .topbar{
      position:sticky;top:0;z-index:5;background:var(--bg);
      display:flex;align-items:center;justify-content:space-between;padding:0 6px;
      height:52px;border-bottom:1px solid var(--border); /* thin separator */
    }
    .top-left{display:flex;align-items:center;gap:12px}
    .top-title{font-size:20px;color:var(--white);font-weight:400}

    /* Language (hover opens) */
    .lang{position:relative}
    .lang-btn{
      display:flex;align-items:center;gap:10px;background:transparent;border:none;color:var(--white);
      font:400 16px/1 Inter;cursor:pointer;padding:8px 10px
    }
    .lang-btn strong{font-weight:400}
    .lang-menu{
      position:absolute;right:0;top:120%;background:var(--card);border:1px solid var(--border);
      border-radius:12px;min-width:260px;max-height:176px;overflow:auto;display:none;box-shadow:0 10px 30px rgba(0,0,0,.4);padding:6px;
      scrollbar-width:thin;scrollbar-color:#6a6a6a transparent;
    }
    .lang-menu::-webkit-scrollbar{width:6px}
    .lang-menu::-webkit-scrollbar-thumb{background:#6a6a6a;border-radius:10px}
    .lang:hover .lang-menu{display:block}
    .lang-item{
      display:flex;align-items:center;gap:8px;padding:10px;border-radius:10px;color:var(--white);cursor:pointer
    }
    .lang-item:hover{background:#17161e}

    /* Grid 2 cols, widened to meet near middle */
    .grid{
      display:grid;
      grid-template-columns:minmax(560px,1.25fr) minmax(560px,1fr);
      gap:var(--gap);
      align-items:start;
      margin-top:18px;
    }
    .left{display:flex;flex-direction:column;gap:var(--gap)}
    .right{display:flex;flex-direction:column;gap:var(--gap)}

    .card{
      background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:18px 18px 20px
    }
    .card h3{
      margin:0 0 16px;display:flex;align-items:center;gap:12px;
      font-size:24px;color:var(--white);font-weight:400
    }
    .card h3 img{width:30px;height:30px} /* larger icons next to titles */

    /* Text blocks (no borders around sentences) */
    .list{display:flex;flex-direction:column;gap:16px}
    .list p{margin:0;color:var(--muted);font-size:20px}

    /* Meters (thin; pure black track, no border) */
    .meter-block{display:flex;flex-direction:column;gap:10px}
    .meter-head{display:flex;align-items:center;justify-content:space-between}
    .meter-title{display:flex;align-items:center;gap:12px;font-size:20px}
    .meter-title img{width:28px;height:28px} /* larger bar icons */
    .meter{height:10px;border-radius:999px;background:var(--black);overflow:hidden}
    .fill{height:100%;width:0%;transition:width 1s ease;border-radius:999px}

    /* Donuts (slightly thicker stroke; value not bold) */
    .hcard{display:flex;gap:16px;align-items:center}
    .circle{width:160px;height:160px;position:relative;display:grid;place-items:center;flex:0 0 160px}
    .circle svg{transform:rotate(-90deg)}
    .circle .val{position:absolute;font-weight:400;font-size:34px;color:var(--white)}
    .circle circle.track{stroke:var(--black);stroke-width:12;fill:none}
    .circle circle.arc{stroke-width:12;fill:none;stroke-linecap:round;stroke-dasharray:440;stroke-dashoffset:440}
    .htext{flex:1;display:flex;flex-direction:column;gap:6px}
    .muted{color:var(--muted);font-size:18px}
    .status{display:flex;align-items:center;gap:8px;margin-top:8px}
    .status .dot{width:10px;height:10px;border-radius:2px;background:var(--green)}
    .status span{font-size:17px;color:var(--white);font-weight:400} /* larger status text */

    /* scroll lists */
    .scroll-y{max-height:320px;overflow:auto;scrollbar-width:thin;scrollbar-color:#6a6a6a transparent}
    .scroll-y::-webkit-scrollbar{width:6px}
    .scroll-y::-webkit-scrollbar-thumb{background:#6a6a6a;border-radius:10px}

    /* Smart Suggestions: full width, centered, wider */
    .wide{grid-column:1 / -1;justify-self:center;width:min(1240px,100%)}

    /* Download (appears at end only) */
    .download-wrap{position:fixed;left:var(--sidebar);right:0;bottom:16px;display:none;justify-content:center;z-index:9}
    .download{
      background:#f2f9fe;color:#000;border:1px solid #cfcfcf;border-radius:16px;
      padding:16px 26px;display:inline-flex;gap:12px;align-items:center;cursor:pointer;font-weight:400;font-size:17px;
      box-shadow:0 6px 28px rgba(0,0,0,.28);
    }
    .download:hover{filter:brightness(1.03)}

    /* Email modal */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:20}
    .modal-card{background:#141319;border:1px solid var(--border);border-radius:18px;padding:18px 18px 16px;width:min(480px,92vw)}
    .modal-card h4{margin:0 0 10px;font-size:18px;font-weight:400}
    .modal-row{display:flex;gap:10px;margin-top:12px}
    .input{
      flex:1;background:#0f0e14;border:1px solid #5a5a5a;border-radius:10px;padding:12px;color:#fff;font:400 15px/1 Inter
    }
    .btn{background:#0f0e14;border:1px solid var(--border);color:#fff;border-radius:10px;padding:12px 14px;cursor:pointer}
    .btn.primary{background:#f2f9fe;color:#000;border-color:#cfcfcf}

    /* Back to top arrow (left side) */
    .totop{
      position:fixed;left:12px;bottom:22px;background:#15141a;border:1px solid var(--border);
      width:44px;height:44px;border-radius:12px;display:grid;place-items:center;opacity:0;pointer-events:none;
      transition:opacity .25s ease, transform .2s ease; z-index:10
    }
    .totop img{width:22px;height:22px}
    .totop.show{opacity:1;pointer-events:auto}
    .totop:hover{transform:translateY(-2px)}

    @media (max-width:1100px){
      .layout{grid-template-columns:1fr}
      .download-wrap{left:0}
      .grid{grid-template-columns:1fr}
      .wide{width:100%}
    }
  </style>
</head>
<body>
  <div class="layout">
    <!-- ===== SIDEBAR ===== -->
    <aside class="sidebar">
      <div class="brand">
        <a href="index.html" aria-label="Go to homepage">
          <img src="https://imgur.com/Z5hv7K9.png" alt="SignSense logo">
          <span>SignSense</span>
        </a>
      </div>

      <nav class="nav">
        <a class="active" href="#">
          <img class="arr" src="https://imgur.com/CHGomYz.png" alt="">
          <img class="icon" src="https://imgur.com/lnQTDuo.png" alt="">
          <span>Overview</span>
        </a>
        <a href="index.html">
          <img class="arr" src="https://imgur.com/xhkeG0y.png" alt="">
          <img class="icon" src="https://imgur.com/kE3okdE.png" alt="">
          <span>Home</span>
        </a>
        <a href="#">
          <img class="arr" src="https://imgur.com/xhkeG0y.png" alt="">
          <img class="icon" src="https://imgur.com/krMnFVT.png" alt="">
          <span>Privacy</span>
        </a>
        <a href="#">
          <img class="arr" src="https://imgur.com/xhkeG0y.png" alt="">
          <img class="icon" src="https://imgur.com/6zHviT6.png" alt="">
          <span>Contact Us</span>
        </a>
        <a href="#" id="leaveReview">
          <img class="arr" src="https://imgur.com/xhkeG0y.png" alt="">
          <img class="icon" src="https://imgur.com/zwr9SOe.png" alt="">
          <span>Leave a Review</span>
        </a>
      </nav>

      <div class="push"></div>

      <!-- Only show at page end -->
      <div class="end-only" id="sidebarEnd">
        <div class="legal">All rights reserved.</div>
        <div class="copy2">© 2025 SignSense</div>
        <div class="footer-sep"></div>
        <div class="copy">Not legal advice.<br/>For informational use only.</div>
      </div>
    </aside>

    <!-- ===== MAIN ===== -->
    <main class="main">
      <div class="topbar">
        <div class="top-left">
          <div class="top-title">Overview</div>
        </div>
        <div class="lang">
          <button class="lang-btn" id="langBtn" type="button">Report Language: <strong id="langNow">English</strong></button>
          <div class="lang-menu" id="langMenu" role="listbox" aria-label="Report Language">
            <div class="lang-item" data-lang="English">English</div>
            <div class="lang-item" data-lang="Spanish">Spanish</div>
            <div class="lang-item" data-lang="German">German</div>
            <div class="lang-item" data-lang="French">French</div>
            <div class="lang-item" data-lang="Italian">Italian</div>
            <div class="lang-item" data-lang="Portuguese">Portuguese</div>
            <div class="lang-item" data-lang="Dutch">Dutch</div>
            <div class="lang-item" data-lang="Romanian">Romanian</div>
            <div class="lang-item" data-lang="Albanian">Albanian</div>
            <div class="lang-item" data-lang="Chinese">Chinese</div>
            <div class="lang-item" data-lang="Japanese">Japanese</div>
            <div class="lang-item" data-lang="Turkish">Turkish</div>
          </div>
        </div>
      </div>

      <div class="grid">
        <!-- LEFT -->
        <div class="left">
          <section class="card">
            <h3><img src="https://imgur.com/CuQFbD7.png" alt="">Summary</h3>
            <div class="list" id="summaryText"></div>
          </section>

          <section class="card meter-block">
            <div class="meter-head">
              <div class="meter-title"><img src="https://imgur.com/nUGfg96.png" alt=""> <span>Confidence to sign freely</span></div>
              <div id="confVal">0%</div>
            </div>
            <div class="meter"><div id="confFill" class="fill"></div></div>
          </section>

          <section class="card meter-block">
            <div class="meter-head">
              <div class="meter-title"><img src="https://imgur.com/UDRuIvO.png" alt=""> <span>Favorability Index</span></div>
              <div id="favVal">0%</div>
            </div>
            <div class="meter"><div id="favFill" class="fill"></div></div>
          </section>

          <section class="card meter-block">
            <div class="meter-head">
              <div class="meter-title"><img src="https://imgur.com/VXZ3kD8.png" alt=""> <span>Deadline pressure</span></div>
              <div id="deadVal">0%</div>
            </div>
            <div class="meter"><div id="deadFill" class="fill"></div></div>
          </section>

          <section class="card" id="issuesCard">
            <h3><img src="https://imgur.com/ppLDtiq.png" alt="">Potential Issues</h3>
            <div class="scroll-y list" id="issuesList"></div>
          </section>

          <section class="card wide">
            <h3><img src="https://imgur.com/EoVDfd5.png" alt="">Smart Suggestions</h3>
            <div class="scroll-y list" id="suggestionsList"></div>
          </section>
        </div>

        <!-- RIGHT -->
        <div class="right">
          <!-- Risk -->
          <section class="card">
            <div class="hcard">
              <div class="circle">
                <svg width="160" height="160">
                  <circle class="track" cx="80" cy="80" r="74"></circle>
                  <circle id="riskArc" class="arc" cx="80" cy="80" r="74"></circle>
                </svg>
                <div class="val" id="riskVal">0%</div>
              </div>
              <div class="htext">
                <h3 style="margin-bottom:0"><img src="https://imgur.com/Myp6Un4.png" alt="">Risk Level</h3>
                <div class="muted" id="riskNote"></div>
                <div class="status"><span class="dot" id="riskDot"></span><span id="riskBadge">Generally Safe</span></div>
              </div>
            </div>
          </section>

          <!-- Clarity -->
          <section class="card">
            <div class="hcard">
              <div class="circle">
                <svg width="160" height="160">
                  <circle class="track" cx="80" cy="80" r="74"></circle>
                  <circle id="clarArc" class="arc" cx="80" cy="80" r="74"></circle>
                </svg>
                <div class="val" id="clarVal">0%</div>
              </div>
              <div class="htext">
                <h3 style="margin-bottom:0"><img src="https://imgur.com/o39xZtC.png" alt="">Clause Clarity</h3>
                <div class="muted" id="clarNote"></div>
                <div class="status"><span class="dot" id="clarDot"></span><span id="clarBadge">Generally Safe</span></div>
              </div>
            </div>
          </section>

          <!-- Clauses -->
          <section class="card" id="clausesCard">
            <h3><img src="https://imgur.com/K04axKU.png" alt="">Main Clauses</h3>
            <div class="list" id="clausesList"></div>
          </section>
        </div>
      </div>
    </main>
  </div>

  <!-- Download (appears near bottom) -->
  <div class="download-wrap" id="dlWrap">
    <button class="download" id="downloadBtn">Download Report</button>
  </div>

  <!-- Email modal -->
  <div class="modal" id="emailModal" aria-modal="true" role="dialog">
    <div class="modal-card">
      <h4>Enter your email to download the PDF report</h4>
      <div class="modal-row">
        <input id="emailInput" class="input" type="email" inputmode="email" placeholder="you@example.com" />
        <button class="btn primary" id="emailSubmit">Download</button>
        <button class="btn" id="emailCancel">Cancel</button>
      </div>
      <div id="emailErr" style="color:#ff6b6b;font-size:13px;margin-top:8px;display:none">Please enter a valid email address.</div>
    </div>
  </div>

  <!-- Back to top -->
  <button class="totop" id="toTop" aria-label="Back to top">
    <img src="https://imgur.com/CHGomYz.png" alt="">
  </button>

<script>
(() => {
  /* ---------- Demo Data: longer sentences ---------- */
  const demo = {
    summary: [
      "This agreement outlines the services, deliverables, and payment expectations in clear language, but several remedies and timing definitions could benefit from tighter phrasing to remove avoidable misunderstandings between the parties.",
      "Rights and responsibilities are balanced overall, with mutual confidentiality and standard intellectual-property ownership; however, the treatment of background tools and derivative works should be clarified to prevent unintentional transfer.",
      "The timeline is achievable if milestones are confirmed early; adding acceptance criteria and a short grace period before penalties would support smoother collaboration and reduce administrative escalations.",
      "Liability is proportionate to fees and excludes consequential damages, which is common; consider explicitly carving out data protection violations to keep the risk profile aligned with both parties’ expectations."
    ],
    risk: { value: 25, note: "Low overall exposure; obligations are explicit and termination is reasonable. Watch late-fee escalation and fine-tune indemnity carve-outs to reflect practical risk sharing." },
    clarity: { value: 80, note: "Plain wording and definitions cover most terms. Two areas—remedies on material breach and data handling specifics—would read cleaner with one or two clarifying sentences." },
    clauses: [
      "Scope & Deliverables — Work is described at a high level with references to an exhibit. Expand each milestone with acceptance criteria so approval is objective and does not depend on subjective interpretation by either party.",
      "Payment Terms — Net-30 with a monthly late fee that may compound; include a seven-day grace period and a hard cap on interest to prevent disproportionate charges during extended administrative delays.",
      "Intellectual Property — Client owns final deliverables while the provider retains pre-existing tools and know-how; confirm whether improvements to those tools remain with the provider to avoid implied assignment.",
      "Confidentiality & Privacy — Standard confidentiality terms apply. Add explicit carve-outs for information independently developed, and reference a basic data handling annex if personal data is processed."
    ],
    issues: [
      "Late-fee compounding could create outsized penalties during longer disputes or internal invoice holds; a cap or switch to simple interest would be more predictable and commercially typical.",
      "Indemnity is one-sided and uncapped for certain categories; a mutual indemnity with a commercial cap tied to fees helps keep risk proportional while still covering third-party claims.",
      "Breach cure periods are referenced but undefined; adding a ten-day cure for non-critical issues avoids accidental termination over administrative mistakes or minor delays."
    ],
    suggestions: [
      "Add objective acceptance criteria and a short user-testing window for each milestone so approvals are clear and disputes are resolved by reference to documented behaviors rather than opinions.",
      "Include a seven-day grace period before late fees accrue, convert compounding to simple interest, and cap total late charges to maintain predictability for both finance teams.",
      "Define “material breach” and insert a standard ten-day cure period, excluding true emergencies, to reduce termination risk from minor or quickly fixable issues.",
      "Clarify IP ownership of enhancements to internal tools, confirming that the client receives broad usage rights while the provider retains the underlying frameworks.",
      "Attach a brief security and data handling appendix referencing encryption at rest, limited access, and deletion timelines to satisfy common privacy expectations."
    ],
    meters:{ confidence:75, favorability:80, deadline:18 }
  };

  let data;
  try{
    const raw = localStorage.getItem('analysisData');
    data = raw ? JSON.parse(raw) : demo;
  }catch(e){ data = demo; }

  /* ---------- Helpers ---------- */
  const $ = s => document.querySelector(s);
  const r = 74; const CIRC = 2*Math.PI*r;
  const cssVar = (v)=>getComputedStyle(document.documentElement).getPropertyValue(v).trim();
  const between = (v,min,max)=>Math.max(min,Math.min(v,max));
  const addP = (el, text) => { const p=document.createElement('p'); p.textContent=text; el.appendChild(p); };

  function colorFor(metric, v){
    if (metric === 'risk') {
      if (v <= 25) return cssVar('--green');
      if (v <= 55) return cssVar('--orange');
      return cssVar('--red');
    }
    if (metric === 'clarity') {
      if (v >= 80) return cssVar('--green');
      if (v >= 45) return cssVar('--orange');
      return cssVar('--red');
    }
    if (metric === 'deadline') {
      if (v <= 25) return cssVar('--green');
      if (v <= 75) return cssVar('--orange');
      return cssVar('--red');
    }
    if (v >= 76) return cssVar('--green');
    if (v >= 50) return cssVar('--orange');
    return cssVar('--red');
  }
  function statusText(metric, v){
    if (metric==='risk'){
      if (v<=25) return "Generally Safe";
      if (v<=55) return "Not Quite Safe";
      return "Not Safe";
    }
    if (metric==='clarity'){
      if (v>=80) return "Generally Safe";
      if (v>=45) return "Not Quite Safe";
      return "Not Safe";
    }
    return "";
  }

  /* ---------- Fill text ---------- */
  const sBox = $("#summaryText"); sBox.innerHTML="";
  (Array.isArray(data.summary)?data.summary:[String(data.summary)]).forEach(t=>addP(sBox,t));

  function listTo(id, arr){ const el=$(id); el.innerHTML=""; (arr && arr.length?arr:["None"]).forEach(t=>addP(el, t)); }
  listTo("#clausesList", data.clauses);
  listTo("#issuesList", data.issues);
  listTo("#suggestionsList", data.suggestions.concat(data.suggestions)); // make it quite many

  /* ---------- Donuts ---------- */
  function setArc(arcEl, metric, value, valEl, badgeEl, dotEl, noteEl, note){
    const v = between(value||0, 0, 100);
    valEl.textContent = v + "%";
    noteEl.textContent = note || "";
    const color = colorFor(metric, v);
    arcEl.style.stroke = color;
    arcEl.style.strokeDasharray = CIRC;
    arcEl.style.strokeDashoffset = CIRC;
    badgeEl.textContent = statusText(metric, v);
    dotEl.style.background = color;
    requestAnimationFrame(()=>{ arcEl.style.transition="stroke-dashoffset 1s ease"; arcEl.style.strokeDashoffset = CIRC * (1 - v/100); });
  }
  setArc($("#riskArc"), 'risk', data.risk?.value ?? 0, $("#riskVal"), $("#riskBadge"), $("#riskDot"), $("#riskNote"), data.risk?.note);
  setArc($("#clarArc"), 'clarity', data.clarity?.value ?? 0, $("#clarVal"), $("#clarBadge"), $("#clarDot"), $("#clarNote"), data.clarity?.note);

  /* ---------- Bars ---------- */
  function setMeter(fill, label, metric, value){
    const v = between(value||0, 0, 100);
    label.textContent = v + "%";
    fill.style.background = colorFor(metric, v);
    requestAnimationFrame(()=>{ fill.style.width = v + "%"; });
  }
  setMeter($("#confFill"), $("#confVal"), 'confidence', data.meters?.confidence ?? 0);
  setMeter($("#favFill"),  $("#favVal"),  'favorability', data.meters?.favorability ?? 0);
  setMeter($("#deadFill"), $("#deadVal"), 'deadline',    data.meters?.deadline ?? 0);

  /* ---------- Equalize heights for Issues & Clauses ---------- */
  function equalize(){
    const a = $("#issuesCard"), b = $("#clausesCard");
    if(!a || !b) return;
    a.style.minHeight = b.style.minHeight = "auto";
    const h = Math.max(a.getBoundingClientRect().height, b.getBoundingClientRect().height);
    a.style.minHeight = b.style.minHeight = h + "px";
  }
  window.addEventListener("load", equalize);
  window.addEventListener("resize", ()=>setTimeout(equalize, 80));

  /* ---------- Language UI ---------- */
  const langNow = $("#langNow");
  $("#langMenu").querySelectorAll(".lang-item").forEach(li=>{
    li.addEventListener("click", ()=>{ langNow.textContent = li.dataset.lang; });
  });

  /* ---------- Show elements only near bottom ---------- */
  const dlWrap = $("#dlWrap");
  const endBox = $("#sidebarEnd");
  const showThresholdPx = 300; // reveal when 300px from bottom
  function nearBottom(){
    const scrolledFromBottom = document.documentElement.scrollHeight - (window.scrollY + window.innerHeight);
    const show = scrolledFromBottom <= showThresholdPx;
    dlWrap.style.display = show ? "flex" : "none";
    endBox.style.display = show ? "block" : "none";
  }
  window.addEventListener("scroll", nearBottom, {passive:true});
  window.addEventListener("load", nearBottom);

  /* ---------- Back-to-top ---------- */
  const toTop = $("#toTop"), showAt = 400;
  window.addEventListener("scroll", ()=>{ if (window.scrollY > showAt) toTop.classList.add("show"); else toTop.classList.remove("show"); }, {passive:true});
  toTop.addEventListener("click", ()=> window.scrollTo({top:0, behavior:"smooth"}));

  /* ---------- Email modal + PDF ---------- */
  const modal = $("#emailModal"), openModal = ()=>modal.style.display="flex", closeModal = ()=>modal.style.display="none";
  $("#downloadBtn").addEventListener("click", openModal);
  $("#emailCancel").addEventListener("click", closeModal);

  function validEmail(e){ return /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test((e||"").trim()); }
  $("#emailSubmit").addEventListener("click", async ()=>{
    const email = $("#emailInput").value || "";
    const err = $("#emailErr");
    if (!validEmail(email)){ err.style.display="block"; return; }
    err.style.display="none";
    await generatePDF("Report", data);
    closeModal();
  });

  async function generatePDF(title, d){
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ unit:"pt", format:"a4" });
    const pageW = doc.internal.pageSize.getWidth();
    const margin = 48, width = pageW - margin*2, lh = 18;

    doc.setFillColor(28,27,34); doc.rect(0,0,pageW,80,'F');
    doc.setTextColor(255,255,255); doc.setFont("helvetica","normal"); doc.setFontSize(18);
    doc.text("SignSense — Contract Analysis Report", margin, 48);

    let y = 100;
    const date = new Date().toLocaleString(); doc.setFontSize(10); doc.setTextColor(189,189,189);
    doc.text(`Generated: ${date}`, margin, y); y += lh*1.6;

    y = section("Summary", y); y = bullets(d.summary, y);
    y = section(`Risk Level: ${d.risk?.value ?? 0}%`, y); y = paragraph(d.risk?.note || "", y);
    y = section(`Clause Clarity: ${d.clarity?.value ?? 0}%`, y); y = paragraph(d.clarity?.note || "", y);
    y = section("Main Clauses", y); y = bullets(d.clauses, y, true);
    y = section("Potential Issues", y); y = bullets(d.issues, y);
    y = section("Smart Suggestions", y); y = bullets(d.suggestions, y);
    doc.save("SignSense_Report.pdf");

    function section(t, y){ if (y>780){ doc.addPage(); y=64; } doc.setFont("helvetica","normal"); doc.setTextColor(255,255,255); doc.setFontSize(12); doc.text(t, margin, y); return y+12; }
    function paragraph(text, y){ if(!text) return y; doc.setFont("helvetica","normal"); doc.setTextColor(189,189,189); doc.setFontSize(11); let lines=doc.splitTextToSize(text,width); lines.forEach(line=>{ if(y>780){doc.addPage(); y=64;} doc.text(line, margin, y); y+=lh;}); return y; }
    function bullets(arr,y,allowNewlines=false){ const list=Array.isArray(arr)?arr:[]; doc.setFont("helvetica","normal"); doc.setTextColor(189,189,189); doc.setFontSize(11);
      list.forEach(t=>{ const text = allowNewlines ? t : String(t).replace(/\n+/g,' '); const lines=doc.splitTextToSize(text,width-12);
        if(y>780){doc.addPage(); y=64;} doc.text("•", margin, y);
        lines.forEach((line,i)=>{ if(i===0){doc.text(line, margin+12, y);} else { y+=lh; doc.text(line, margin+12, y);} });
        y+=lh;
      }); return y;
    }
  }

  /* ---------- Review link (placeholder) ---------- */
  $("#leaveReview").addEventListener("click", (e)=>{ e.preventDefault(); alert("Hook this to your reviews form URL."); });
})();
</script>
</body>
</html>
