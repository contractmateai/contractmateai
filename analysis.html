<!DOCTYPE html> 
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>SignSense — Analysis</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <style>
    :root{
      --bg:#0e0c13;
      --card:#1c1b22;
      --border:#3b3b3b;
      --white:#ffffff;
      --muted:#bdbdbd;
      --green:#00ff65;
      --orange:#df911a;
      --red:#fe0000;
      --black:#000000;
      --radius:21px;
      --gap:18px;
      --sidebar:300px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--white);font:400 16px/1.7 Inter,system-ui,Segoe UI,Roboto,Arial}

    .layout{display:grid;grid-template-columns:var(--sidebar) 1fr;min-height:100vh}

    /* ===== SIDEBAR ===== */
    .sidebar{
      background:#0f0e14;border-right:1px solid var(--border);
      padding:12px 16px 16px;position:sticky;top:0;height:100vh;display:flex;flex-direction:column;gap:16px
    }
    .brand{padding:0 2px}
    .brand a{display:flex;align-items:center;gap:12px;height:52px;text-decoration:none;color:var(--white)}
    .brand img{width:34px;height:34px}
    .brand span{font-size:22px;color:var(--white);font-weight:400}

    .nav{display:flex;flex-direction:column;gap:10px;margin-top:6px}
    .nav a{
      text-decoration:none;color:var(--muted);display:flex;align-items:center;gap:16px;
      padding:16px 18px;border-radius:16px;border:1px solid transparent;transition:border-color .2s ease;
      font-size:19px;
    }
    .nav a img.icon{width:30px;height:30px;opacity:.95}
    .nav a img.arr{width:20px;height:20px;opacity:.9}
    .nav a.active{background:#181620;border:1px solid var(--border);color:var(--white)}
    .nav a:hover{background:transparent;border-color:var(--border);color:var(--white)}
    .nav a.active:hover{background:#181620;border-color:var(--border)}

    .push{flex:1}
    .end-only{display:none}

    .legal,.copy,.copy2{color:var(--muted);font-size:15px;line-height:1.6}
    .footer-sep{height:1px;background:var(--border);margin:10px 0}

    /* ===== MAIN ===== */
    .main{padding:0 20px 140px;display:grid;grid-template-rows:auto 1fr;gap:var(--gap)}
    .topbar{
      position:sticky;top:0;z-index:5;background:var(--bg);
      display:flex;align-items:center;justify-content:space-between;padding:0 6px;
      height:52px;border-bottom:1px solid var(--border);
    }
    .top-left{display:flex;align-items:center;gap:12px}
    .top-title{font-size:20px;color:var(--white);font-weight:400}

    /* Language (hover opens) */
    .lang{position:relative}
    .lang-btn{display:flex;align-items:center;gap:10px;background:transparent;border:none;color:var(--white);font:400 16px/1 Inter;cursor:pointer;padding:8px 10px}
    .lang-btn strong{font-weight:400}
    .lang-menu{
      position:absolute;right:0;top:120%;background:var(--card);border:1px solid var(--border);
      border-radius:12px;min-width:260px;max-height:176px;overflow:auto;display:none;box-shadow:0 10px 30px rgba(0,0,0,.4);padding:6px;
      scrollbar-width:thin;scrollbar-color:#6a6a6a transparent;
    }
    .lang-menu::-webkit-scrollbar{width:6px}
    .lang-menu::-webkit-scrollbar-thumb{background:#6a6a6a;border-radius:10px}
    .lang:hover .lang-menu{display:block}
    .lang-item{display:flex;align-items:center;gap:8px;padding:10px;border-radius:10px;color:var(--white);cursor:pointer}
    .lang-item:hover{background:#17161e}

    /* Grid */
    .grid{
      display:grid;
      grid-template-columns:minmax(560px,1.25fr) minmax(560px,1fr);
      gap:var(--gap);
      align-items:start;
      margin-top:18px;
    }
    .left,.right{display:flex;flex-direction:column;gap:var(--gap)}

    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:18px 18px 20px}
    .card h3{margin:0 0 16px;display:flex;align-items:center;gap:12px;font-size:24px;color:var(--white);font-weight:400}
    .card h3 img{width:30px;height:30px}

    /* Text blocks */
    .list{display:flex;flex-direction:column;gap:16px}
    .list p{margin:0;color:var(--muted);font-size:20px;overflow-wrap:anywhere;word-break:break-word}

    /* Bullets (Potential Issues) */
    .bullets{margin:0;color:var(--muted);font-size:20px;padding-left:22px;list-style:disc}
    .bullets li{margin:0 0 12px}

    /* Numbered (Main Clauses / Suggestions) */
    .numbered{counter-reset:item}
    .numbered p{position:relative;padding-left:26px}
    .numbered p::before{counter-increment:item;content:counter(item) ".";position:absolute;left:0;top:0;color:var(--muted)}

    /* Meters */
    .meter-block{display:flex;flex-direction:column;gap:10px}
    .meter-head{display:flex;align-items:center;justify-content:space-between}
    .meter-title{display:flex;align-items:center;gap:12px;font-size:22px}
    .meter-title img{width:32px;height:32px}
    .meter{height:10px;border-radius:999px;background:var(--black);overflow:hidden}
    .fill{height:100%;width:0%;transition:width 1s ease;border-radius:999px}

    /* Donuts */
    .hcard{display:flex;gap:16px;align-items:center}
    .circle{width:160px;height:160px;position:relative;display:grid;place-items:center;flex:0 0 160px}
    .circle svg{transform:rotate(-90deg)}
    .circle .val{position:absolute;font-weight:400;font-size:34px;color:var(--white)}
    .circle circle.track{stroke:var(--black);stroke-width:12;fill:none}
    .circle circle.arc{stroke-width:12;fill:none;stroke-linecap:round;stroke-dasharray:440;stroke-dashoffset:440}
    .htext{flex:1;display:flex;flex-direction:column;gap:8px}
    .muted{color:var(--muted);font-size:18px}
    .status{display:flex;align-items:center;gap:8px;margin-top:8px}
    .status .dot{width:10px;height:10px;border-radius:2px;background:var(--green)}
    .status span{font-size:17px;color:var(--white);font-weight:400}

    /* ===== Score Checker (Clause-Clarity style, edited) ===== */
    #scoreCard{margin-top:12px;}                 /* lower a bit to align with Smart Suggestions */
    #confRightCard{margin-top:12px;}             /* lower the added right-side confidence bar too */
    #scoreCard .score-center{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;text-align:center}
    #scoreCard .score-pct{font-size:42px}

    .score-side{flex:1;display:flex;flex-direction:column;gap:14px}
    .score-remark{font-size:20px;color:var(--muted)} /* bigger sentence */
    .score-bar{position:relative;height:22px;border-radius:14px;background:linear-gradient(90deg,#ff6b6b 0%, #ffd166 45%, #00e676 100%);border:1px solid #2f2f2f;box-shadow:inset 0 1px 0 rgba(255,255,255,.05);width:100%}
    .score-ind{position:absolute;top:-6px;height:34px;width:3px;background:#fff;border-radius:2px;left:calc(80% - 1.5px);box-shadow:0 0 8px rgba(255,255,255,.6)}
    .score-scale{display:flex;justify-content:space-between;font-size:16px;color:var(--muted)}

    /* Remove inner scrolls globally */
    .scroll-y{max-height:none !important;overflow:visible !important}

    /* Download button */
    .download-wrap{position:fixed;left:var(--sidebar);right:0;bottom:16px;display:none;justify-content:center;z-index:9}
    .download{background:#f2f9fe;color:#000;border:1px solid #cfcfcf;border-radius:16px;padding:16px 26px;display:inline-flex;gap:12px;align-items:center;cursor:pointer;font-weight:400;font-size:17px;box-shadow:0 6px 28px rgba(0,0,0,.28)}
    .download:hover{filter:brightness(1.03)}

    /* Email modal */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:20}
    .modal-card{background:#141319;border:1px solid var(--border);border-radius:18px;padding:18px 18px 16px;width:min(480px,92vw)}
    .modal-card h4{margin:0 0 10px;font-size:18px;font-weight:400}
    .modal-row{display:flex;gap:10px;margin-top:12px}
    .input{flex:1;background:#0f0e14;border:1px solid #5a5a5a;border-radius:10px;padding:12px;color:#fff;font:400 15px/1 Inter}
    .btn{background:#0f0e14;border:1px solid var(--border);color:#fff;border-radius:10px;padding:12px 14px;cursor:pointer}
    .btn.primary{background:#f2f9fe;color:#000;border-color:#cfcfcf}

    @media (max-width:1100px){
      .layout{grid-template-columns:1fr}
      .download-wrap{left:0}
      .grid{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="layout">
    <!-- ===== SIDEBAR ===== -->
    <aside class="sidebar">
      <div class="brand">
        <a href="index.html" aria-label="Go to homepage">
          <img src="https://imgur.com/Z5hv7K9.png" alt="SignSense logo">
          <span>SignSense</span>
        </a>
      </div>

      <nav class="nav">
        <a class="active" href="#">
          <img class="arr" src="https://imgur.com/CHGomYz.png" alt="">
          <img class="icon" src="https://imgur.com/lnQTDuo.png" alt="">
          <span>Overview</span>
        </a>
        <a href="index.html"><img class="arr" src="https://imgur.com/xhkeG0y.png" alt=""><img class="icon" src="https://imgur.com/kE3okdE.png" alt=""><span>Home</span></a>
        <a href="#"><img class="arr" src="https://imgur.com/xhkeG0y.png" alt=""><img class="icon" src="https://imgur.com/krMnFVT.png" alt=""><span>Privacy</span></a>
        <a href="#"><img class="arr" src="https://imgur.com/xhkeG0y.png" alt=""><img class="icon" src="https://imgur.com/6zHviT6.png" alt=""><span>Contact Us</span></a>
        <a href="#" id="leaveReview"><img class="arr" src="https://imgur.com/xhkeG0y.png" alt=""><img class="icon" src="https://imgur.com/zwr9SOe.png" alt=""><span>Leave a Review</span></a>
      </nav>

      <div class="push"></div>
      <div class="end-only" id="sidebarEnd">
        <div class="legal">All rights reserved.</div>
        <div class="copy2">© 2025 SignSense</div>
        <div class="footer-sep"></div>
        <div class="copy">Not legal advice.<br/>For informational use only.</div>
      </div>
    </aside>

    <!-- ===== MAIN ===== -->
    <main class="main">
      <div class="topbar">
        <div class="top-left"><div class="top-title">Overview</div></div>
        <div class="lang">
          <button class="lang-btn" id="langBtn" type="button">Report Language: <strong id="langNow">English</strong></button>
          <div class="lang-menu" id="langMenu" role="listbox" aria-label="Report Language">
            <div class="lang-item" data-lang="English">English</div><div class="lang-item" data-lang="Spanish">Spanish</div><div class="lang-item" data-lang="German">German</div><div class="lang-item" data-lang="French">French</div><div class="lang-item" data-lang="Italian">Italian</div><div class="lang-item" data-lang="Portuguese">Portuguese</div><div class="lang-item" data-lang="Dutch">Dutch</div><div class="lang-item" data-lang="Romanian">Romanian</div><div class="lang-item" data-lang="Albanian">Albanian</div><div class="lang-item" data-lang="Chinese">Chinese</div><div class="lang-item" data-lang="Japanese">Japanese</div><div class="lang-item" data-lang="Turkish">Turkish</div>
          </div>
        </div>
      </div>

      <div class="grid">
        <!-- LEFT -->
        <div class="left">
          <section class="card">
            <h3><img src="https://imgur.com/CuQFbD7.png" alt="">Summary</h3>
            <div class="list" id="summaryText"></div>
          </section>

          <!-- Professionalism @95% with new icon (unchanged from last turn) -->
          <section class="card meter-block">
            <div class="meter-head">
              <div class="meter-title"><img src="https://imgur.com/EdMAMnx.png" alt=""> <span>Professionalism</span></div>
              <div id="confVal">0%</div>
            </div>
            <div class="meter"><div id="confFill" class="fill"></div></div>
          </section>

          <section class="card meter-block">
            <div class="meter-head">
              <div class="meter-title"><img src="https://imgur.com/UDRuIvO.png" alt=""> <span>Favorability Index</span></div>
              <div id="favVal">0%</div>
            </div>
            <div class="meter"><div id="favFill" class="fill"></div></div>
          </section>

          <section class="card meter-block">
            <div class="meter-head">
              <div class="meter-title"><img src="https://imgur.com/VXZ3kD8.png" alt=""> <span>Deadline pressure</span></div>
              <div id="deadVal">0%</div>
            </div>
            <div class="meter"><div id="deadFill" class="fill"></div></div>
          </section>

          <section class="card" id="issuesCard">
            <h3><img src="https://imgur.com/ppLDtiq.png" alt="">Potential Issues</h3>
            <ul class="bullets" id="issuesList"></ul>
          </section>

          <section class="card" id="suggestionsCard">
            <h3><img src="https://imgur.com/EoVDfd5.png" alt="">Smart Suggestions</h3>
            <div class="list numbered" id="suggestionsList"></div>
          </section>
        </div>

        <!-- RIGHT -->
        <div class="right">
          <!-- Risk -->
          <section class="card">
            <div class="hcard">
              <div class="circle">
                <svg width="160" height="160" viewBox="0 0 160 160">
                  <circle class="track" cx="80" cy="80" r="74"></circle>
                  <circle id="riskArc" class="arc" cx="80" cy="80" r="74"></circle>
                </svg>
                <div class="val" id="riskVal">0%</div>
              </div>
              <div class="htext">
                <h3 style="margin-bottom:0"><img src="https://imgur.com/Myp6Un4.png" alt="">Risk Level</h3>
                <div class="muted" id="riskNote"></div>
                <div class="status"><span class="dot" id="riskDot"></span><span id="riskBadge">Generally Safe</span></div>
              </div>
            </div>
          </section>

          <!-- Clarity -->
          <section class="card">
            <div class="hcard">
              <div class="circle">
                <svg width="160" height="160" viewBox="0 0 160 160">
                  <circle class="track" cx="80" cy="80" r="74"></circle>
                  <circle id="clarArc" class="arc" cx="80" cy="80" r="74"></circle>
                </svg>
                <div class="val" id="clarVal">0%</div>
              </div>
              <div class="htext">
                <h3 style="margin-bottom:0"><img src="https://imgur.com/o39xZtC.png" alt="">Clause Clarity</h3>
                <div class="muted" id="clarNote"></div>
                <div class="status"><span class="dot" id="clarDot"></span><span id="clarBadge">Generally Safe</span></div>
              </div>
            </div>
          </section>

          <!-- Clauses -->
          <section class="card" id="clausesCard">
            <h3><img src="https://imgur.com/K04axKU.png" alt="">Main Clauses</h3>
            <div class="list numbered" id="clausesList"></div>
          </section>

          <!-- Score Checker -->
          <section class="card" id="scoreCard">
            <div class="hcard">
              <!-- Donut -->
              <div class="circle">
                <svg width="160" height="160" viewBox="0 0 160 160">
                  <circle class="track" cx="80" cy="80" r="74"></circle>
                  <circle id="scoreArc" class="arc" cx="80" cy="80" r="74"></circle>
                </svg>
                <div class="score-center">
                  <div class="score-pct" id="scorePct">80%</div>
                </div>
              </div>

              <!-- Right side -->
              <div class="score-side">
                <h3 style="margin-bottom:0"><img src="https://imgur.com/mFvyCj7.png" alt="">Score Checker</h3>

                <!-- Sentence ABOVE bar -->
                <div class="score-remark">The contract is nearly perfectly done.</div>

                <div class="score-bar">
                  <span class="score-ind" id="scoreInd"></span>
                </div>
                <div class="score-scale"><span>Unsafe</span><span>Safe</span><span>Very Safe</span></div>
              </div>
            </div>
          </section>

          <!-- Confidence to sign freely (under Score Checker) -->
          <section class="card meter-block" id="confRightCard">
            <div class="meter-head">
              <div class="meter-title"><img src="https://imgur.com/nUGfg96.png" alt=""> <span>Confidence to sign freely</span></div>
              <div id="conf2Val">0%</div>
            </div>
            <div class="meter"><div id="conf2Fill" class="fill"></div></div>
          </section>
        </div>
      </div>
    </main>
  </div>

  <!-- Download (appears near bottom) -->
  <div class="download-wrap" id="dlWrap">
    <button class="download" id="downloadBtn">Download Report</button>
  </div>

  <!-- Email modal -->
  <div class="modal" id="emailModal" aria-modal="true" role="dialog">
    <div class="modal-card">
      <h4>Enter your email to download the PDF report</h4>
      <div class="modal-row">
        <input id="emailInput" class="input" type="email" inputmode="email" placeholder="you@example.com" />
        <button class="btn primary" id="emailSubmit">Download</button>
        <button class="btn" id="emailCancel">Cancel</button>
      </div>
      <div id="emailErr" style="color:#ff6b6b;font-size:13px;margin-top:8px;display:none">Please enter a valid email address.</div>
    </div>
  </div>

<script>
(() => {
  /* ---------- Static content ---------- */
  const demo = {
    summary: [
      "This contract is generally favorable with low overall risk, but several timing and remedy definitions could be tightened to avoid avoidable confusion between the parties.",
      "Payment schedule and termination rights are presented in clear, plain language; still, a couple of legacy phrases can be simplified so non-lawyers can follow without re-reading.",
      "Watch late-fee compounding and define 'material breach' with an objective test so everyday admin delays don’t escalate into disputes.",
    ],
    risk: { value: 25, note: "Termination, dispute handling and scope changes need to be tightened a bit better." },
    clarity: { value: 80, note: "Some provisions are thin on definitions which reduces predictability in changes." },
    clauses: [
      "Payment Terms: Net 30 with 2% per month late fee; add a short grace period and a cap so charges remain predictable.",
      "Scope of Work: Deliverables listed in Schedule A; include acceptance criteria so approvals are objective.",
      "IP & Licensing: Client owns final assets; creator keeps tools, methods and pre-existing know-how.",
      "Termination: 30-day convenience; immediate for cause. Add a ten-day cure for minor issues to prevent accidental termination.",
      "Confidentiality: Standard carve-outs (public information, independently developed) and reasonable survival period.",
      "Scope of Work: Deliverables listed in Schedule A; include acceptance criteria so approvals are objective.",
      "IP & Licensing: Client owns final assets; creator keeps tools, methods and pre-existing know-how and add a short grace period and a cap."
    ],
    issues: [
      "Late-fee compounding escalates costs on long delays; switch to simple interest with a reasonable cap to prevent outsized penalties.",
      "Indemnity is one-sided and uncapped; replace with mutual indemnity and add a commercial cap tied to fees for proportional risk.",
      "Undefined cure periods allow immediate termination for minor faults; add a standard 10-day cure for non-critical breaches.",
      "Ambiguous definition of “material breach” invites disputes; specify an objective test and carve-out for trivial delays.",
      "Scope changes lack a written change-order process; require signed amendments with impact on price/timeline captured.",
    ],
    suggestions: [
      "Add objective acceptance criteria and a short user-testing window for each milestone so sign-off is clear and quick.",
      "Insert a 5–7 day grace period before late fees accrue and convert compounding to simple interest with a total cap.",
      "Define “material breach” and include a standard ten-day cure (except for true emergencies) to minimize unnecessary escalations.".
    ],
    meters:{ professionalism:95, confidence:75, favorability:80, deadline:18 }
  };

  const data = demo;
  const $ = s => document.querySelector(s);
  const cssVar = v => getComputedStyle(document.documentElement).getPropertyValue(v).trim();
  const between = (v,min,max)=>Math.max(min,Math.min(v,max));
  const addP = (el, t)=>{const p=document.createElement('p');p.textContent=t;el.appendChild(p);};

  function colorFor(metric, v){
    if (metric === 'risk') { if (v<=25) return cssVar('--green'); if (v<=55) return cssVar('--orange'); return cssVar('--red'); }
    if (metric === 'clarity') { if (v>=80) return cssVar('--green'); if (v>=45) return cssVar('--orange'); return cssVar('--red'); }
    if (metric === 'deadline') { if (v<=25) return cssVar('--green'); if (v<=75) return cssVar('--orange'); return cssVar('--red'); }
    if (v>=76) return cssVar('--green'); if (v>=50) return cssVar('--orange'); return cssVar('--red');
  }

  /* Summary text */
  const sBox=$("#summaryText"); sBox.innerHTML="";
  (Array.isArray(data.summary)?data.summary:[String(data.summary)]).forEach(t=>addP(sBox,t));

  function listTo(id, arr){ const el=$(id); el.innerHTML=""; (arr&&arr.length?arr:[""]).forEach(t=>addP(el,t)); }
  listTo("#clausesList", data.clauses);

  /* Issues */
  (function(){ const el=$("#issuesList"); el.innerHTML=""; (data.issues||[]).forEach(t=>{const li=document.createElement('li'); li.textContent=t; el.appendChild(li);}); })();

  listTo("#suggestionsList", data.suggestions);

  /* Donut helper — now also updates % and note when provided */
  function setArc(arcEl, metric, value, valEl, noteEl, note){
    const v = between(value||0, 0, 100);
    const rr = parseFloat(arcEl.getAttribute('r')) || 74;
    const circ = 2*Math.PI*rr;
    arcEl.style.stroke = colorFor(metric, v);
    arcEl.style.strokeDasharray = circ;
    arcEl.style.strokeDashoffset = circ;
    requestAnimationFrame(()=>{ arcEl.style.transition="stroke-dashoffset 1s ease"; arcEl.style.strokeDashoffset = circ * (1 - v/100); });
    if (valEl) valEl.textContent = v + "%";
    if (noteEl) noteEl.textContent = note || "";
  }

  /* Right-column donuts — bring back 25% and 80% + their notes */
  setArc($("#riskArc"), 'risk', data.risk?.value ?? 0, $("#riskVal"), $("#riskNote"), data.risk?.note);
  setArc($("#clarArc"), 'clarity', data.clarity?.value ?? 0, $("#clarVal"), $("#clarNote"), data.clarity?.note);

  /* Bars */
  function setMeter(fill, label, metric, value){
    const v = between(value||0, 0, 100);
    label.textContent = v + "%";
    fill.style.background = colorFor(metric, v);
    requestAnimationFrame(()=>{ fill.style.width = v + "%"; });
  }
  /* LEFT column meters */
  setMeter($("#confFill"), $("#confVal"), 'professionalism', data.meters?.professionalism ?? 95);
  setMeter($("#favFill"), $("#favVal"), 'favorability', data.meters?.favorability ?? 0);
  setMeter($("#deadFill"), $("#deadVal"), 'deadline',    data.meters?.deadline ?? 0);

  /* Score Checker */
  (function scoreChecker(){
    const v = 80;
    setArc($("#scoreArc"), 'confidence', v);
    $("#scorePct").textContent = v + "%";
    $("#scoreInd").style.left = "calc(80% - 1.5px)";
  })();

  /* Right-side Confidence bar */
  setMeter($("#conf2Fill"), $("#conf2Val"), 'confidence', data.meters?.confidence ?? 0);

  /* Language dropdown */
  const langNow=$("#langNow");
  $("#langMenu").querySelectorAll(".lang-item").forEach(li=>li.addEventListener("click", ()=>{ langNow.textContent = li.dataset.lang; }));

  /* Bottom reveals */
  const dlWrap=$("#dlWrap"), endBox=$("#sidebarEnd"), showThresholdPx=300;
  function nearBottom(){
    const scrolledFromBottom=document.documentElement.scrollHeight-(window.scrollY+window.innerHeight);
    const show=scrolledFromBottom<=showThresholdPx;
    dlWrap.style.display=show?"flex":"none";
    endBox.style.display=show?"block":"none";
  }
  window.addEventListener("scroll", nearBottom, {passive:true});
  window.addEventListener("load", nearBottom);

  /* Email modal + PDF (unchanged) */
  const modal=$("#emailModal"), openModal=()=>modal.style.display="flex", closeModal=()=>modal.style.display="none";
  $("#downloadBtn").addEventListener("click", openModal);
  $("#emailCancel").addEventListener("click", closeModal);
  function validEmail(e){ return /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test((e||"").trim()); }
  $("#emailSubmit").addEventListener("click", async ()=>{
    const email=$("#emailInput").value||"", err=$("#emailErr");
    if(!validEmail(email)){ err.style.display="block"; return; }
    err.style.display="none";
    await generatePDF("Report", demo);
    closeModal();
  });

  async function generatePDF(title, d){
    const { jsPDF } = window.jspdf;
    const doc=new jsPDF({ unit:"pt", format:"a4" });
    const pageW=doc.internal.pageSize.getWidth();
    const margin=48, width=pageW-margin*2, lh=18;

    doc.setFillColor(28,27,34); doc.rect(0,0,pageW,80,'F');
    doc.setTextColor(255,255,255); doc.setFont("helvetica","normal"); doc.setFontSize(18);
    doc.text("SignSense — Contract Analysis Report", margin, 48);

    let y=100;
    const date=new Date().toLocaleString(); doc.setFontSize(10); doc.setTextColor(189,189,189);
    doc.text(`Generated: ${date}`, margin, y); y+=lh*1.6;

    y=section("Summary", y); y=bullets(d.summary, y);
    y=section(`Risk Level: ${d.risk?.value ?? 0}%`, y); y=paragraph(d.risk?.note || "", y);
    y=section(`Clause Clarity: ${d.clarity?.value ?? 0}%`, y); y=paragraph(d.clarity?.note || "", y);
    y=section("Main Clauses", y); y=bullets(d.clauses, y);
    y=section("Potential Issues", y); y=bullets(d.issues, y);
    y=section("Smart Suggestions", y); y=bullets(d.suggestions, y);
    doc.save("SignSense_Report.pdf");

    function section(t,y){ if(y>780){ doc.addPage(); y=64; } doc.setFont("helvetica","normal"); doc.setTextColor(255,255,255); doc.setFontSize(12); doc.text(t, margin, y); return y+12; }
    function paragraph(text,y){ if(!text) return y; doc.setFont("helvetica","normal"); doc.setTextColor(189,189,189); doc.setFontSize(11); let lines=doc.splitTextToSize(text,width); lines.forEach(line=>{ if(y>780){doc.addPage(); y=64;} doc.text(line, margin, y); y+=lh;}); return y; }
    function bullets(arr,y){ const list=Array.isArray(arr)?arr:[]; doc.setFont("helvetica","normal"); doc.setTextColor(189,189,189); doc.setFontSize(11);
      list.forEach(t=>{ const lines=doc.splitTextToSize(String(t),width-12);
        if(y>780){doc.addPage(); y=64;} doc.text("•", margin, y);
        lines.forEach((line,i)=>{ if(i===0){doc.text(line, margin+12, y);} else { y+=lh; doc.text(line, margin+12, y);} });
        y+=lh;
      }); return y;
    }
  }

  $("#leaveReview").addEventListener("click", (e)=>{ e.preventDefault(); alert("Hook this to your reviews form URL."); });
})();
</script>
</body>
</html>
