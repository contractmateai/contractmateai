<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>SignSense â€” Analysis</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <style>
    :root{
      --bg:#0e0c13;
      --card:#1c1b22;
      --border:#3b3b3b;           /* hairline card border */
      --white:#ffffff;
      --muted:#bdbdbd;
      --green:#00ff65;
      --orange:#df911a;
      --red:#fe0000;
      --black:#000000;
      --radius:21px;
      --gap:20px;
      --sidebar:310px;            /* slightly wider sidebar */
      --mastH:60px;               /* sticky header height */
      --topOffset:10px;           /* bring header a bit lower */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--white);font:400 16.5px/1.75 Inter,system-ui,Segoe UI,Roboto,Arial}

    .layout{display:grid;grid-template-columns:var(--sidebar) 1fr;min-height:100vh}

    /* ===== SIDEBAR ===== */
    .sidebar{
      background:#0f0e14;border-right:1px solid var(--border);
      padding:0 16px 16px;
      position:sticky;top:0;height:100vh;
      display:flex;flex-direction:column;gap:16px
    }
    .brand{padding:0 12px 0 14px} /* move a bit to the right */
    .brand a{
      display:flex;align-items:center;gap:12px;
      height:var(--mastH);                 /* aligns with header row */
      text-decoration:none;color:var(--white);
    }
    .brand img{width:36px;height:36px}
    .brand span{font-size:24px;color:var(--white);font-weight:400}

    .nav{display:flex;flex-direction:column;gap:12px;margin-top:6px}
    .nav a{
      text-decoration:none;color:var(--muted);
      display:flex;align-items:center;gap:16px;
      padding:15px 16px;border-radius:16px;border:1px solid transparent;
      transition:border-color .2s ease;
      font-size:19px;                      /* larger labels */
    }
    .nav a img.icon{width:30px;height:30px;opacity:.95}    /* larger icons */
    .nav a img.arr{width:20px;height:20px;opacity:.9}
    .nav a.active{background:#181620;border:1px solid var(--border);color:var(--white)}
    .nav a:hover{background:transparent;border-color:var(--border);color:var(--white)}
    .nav a.active:hover{background:#181620;border-color:var(--border)} /* no change on active */

    .push{flex:1}
    .end-only{display:none}
    .legal{color:var(--muted);font-size:15.5px;line-height:1.6}
    .footer-sep{height:1px;background:var(--border);margin:10px 0}
    .copy{color:var(--muted);font-size:15.5px}
    .copy2{color:var(--muted);font-size:15.5px;margin-top:6px}

    /* ===== MAIN / TOP STRIP ===== */
    .main{padding:0 20px 140px;display:grid;grid-template-rows:auto 1fr;gap:var(--gap)}
    .topbar{
      position:sticky;top:var(--topOffset);z-index:6;background:var(--bg);
      display:flex;align-items:center;justify-content:space-between;padding:0 6px;
      height:var(--mastH);
    }
    .mastline{            /* full-width line under brand + header */
      position:sticky;top:calc(var(--topOffset) + var(--mastH));
      height:1px;background:var(--border);z-index:5;
      width:100vw;left:0;margin-left:calc(-1 * (var(--sidebar) + 20px));
    }
    .top-left{display:flex;align-items:center;gap:12px}
    .top-title{font-size:22px;color:var(--white);font-weight:400}

    /* Language (hover opens) */
    .lang{position:relative}
    .lang-btn{
      display:flex;align-items:center;gap:10px;background:transparent;border:none;color:var(--white);
      font:400 17px/1 Inter;cursor:default;padding:8px 10px
    }
    .lang-btn strong{font-weight:400}
    .lang-menu{
      position:absolute;right:0;top:115%;background:var(--card);border:1px solid var(--border);
      border-radius:12px;min-width:260px;max-height:180px; /* ~4 items */
      overflow:auto;display:none;box-shadow:0 10px 30px rgba(0,0,0,.4);padding:6px;
      scrollbar-width:none; /* Firefox: hide */
    }
    .lang-menu::-webkit-scrollbar{width:0;height:0} /* WebKit: hide */
    .lang:hover .lang-menu{display:block}
    .lang-item{
      display:flex;align-items:center;gap:8px;padding:10px;border-radius:10px;color:var(--white);cursor:pointer
    }
    .lang-item:hover{background:#17161e}

    /* Grid 2 cols, widened to meet near middle */
    .grid{
      display:grid;
      grid-template-columns:minmax(590px,1.25fr) minmax(590px,1fr);
      gap:var(--gap);
      align-items:start;
      margin-top:10px;
    }
    .left{display:flex;flex-direction:column;gap:var(--gap)}
    .right{display:flex;flex-direction:column;gap:var(--gap)}

    /* Cards */
    .card{
      background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:18px 18px 22px
    }
    .card h3{
      margin:0 0 16px;display:flex;align-items:center;gap:14px;
      font-size:26px;color:var(--white);font-weight:400      /* bigger titles */
    }
    .card h3 img{width:34px;height:34px}                     /* bigger title icons */

    /* Text blocks (no borders around sentences) */
    .list{display:flex;flex-direction:column;gap:16px}
    .list p{margin:0;color:var(--muted);font-size:20px}

    /* Meters (thin bar; pure black track, no border) */
    .meter-block{display:flex;flex-direction:column;gap:12px}
    .meter-head{display:flex;align-items:center;justify-content:space-between}
    .meter-title{display:flex;align-items:center;gap:14px;font-size:22px}     /* bigger bar titles */
    .meter-title img{width:32px;height:32px}                                   /* bigger bar icons */
    .meter{height:10px;border-radius:999px;background:var(--black);overflow:hidden}
    .fill{height:100%;width:0%;transition:width 1s ease;border-radius:999px}

    /* Donuts (slightly thicker; value a bit larger, not bold) */
    .hcard{display:flex;gap:18px;align-items:center}
    .circle{width:160px;height:160px;position:relative;display:grid;place-items:center;flex:0 0 160px}
    .circle svg{transform:rotate(-90deg)}
    .circle .val{position:absolute;font-weight:400;font-size:40px;color:var(--white)} /* bigger % */
    .circle circle.track{stroke:var(--black);stroke-width:14;fill:none}               /* thicker */
    .circle circle.arc{stroke-width:14;fill:none;stroke-linecap:round;stroke-dasharray:440;stroke-dashoffset:440}
    .htext{flex:1;display:flex;flex-direction:column;gap:8px}
    .muted{color:var(--muted);font-size:19px}
    .status{display:flex;align-items:center;gap:8px;margin-top:6px}
    .status .dot{width:10px;height:10px;border-radius:2px;background:var(--green)}
    .status span{font-size:19px;color:var(--white);font-weight:400}

    /* Scrollable lists inside cards */
    .scroll-y{max-height:340px;overflow:auto;scrollbar-width:thin;scrollbar-color:#6a6a6a transparent}
    .scroll-y::-webkit-scrollbar{width:6px}
    .scroll-y::-webkit-scrollbar-thumb{background:#6a6a6a;border-radius:10px}

    /* Smart Suggestions: full width, centered, wider */
    .wide{grid-column:1 / -1;justify-self:center;width:min(1260px,100%)}

    /* Download (appears at end only) */
    .download-wrap{position:fixed;left:var(--sidebar);right:0;bottom:16px;display:none;justify-content:center;z-index:9}
    .download{
      background:#f2f9fe;color:#000;border:1px solid #cfcfcf;border-radius:16px;
      padding:18px 30px;display:inline-flex;gap:12px;align-items:center;cursor:pointer;font-weight:400;font-size:18px;
      box-shadow:0 6px 28px rgba(0,0,0,.28);
    }
    .download:hover{filter:brightness(1.03)}

    /* Email modal */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:20}
    .modal-card{background:#141319;border:1px solid var(--border);border-radius:18px;padding:18px 18px 16px;width:min(520px,92vw)}
    .modal-card h4{margin:0 0 10px;font-size:18px;font-weight:400}
    .modal-row{display:flex;gap:10px;margin-top:12px}
    .input{
      flex:1;background:#0f0e14;border:1px solid #5a5a5a;border-radius:10px;padding:12px;color:#fff;font:400 15px/1 Inter
    }
    .btn{background:#0f0e14;border:1px solid var(--border);color:#fff;border-radius:10px;padding:12px 14px;cursor:pointer}
    .btn.primary{background:#f2f9fe;color:#000;border-color:#cfcfcf}

    @media (max-width:1150px){
      .layout{grid-template-columns:1fr}
      .download-wrap{left:0}
      .grid{grid-template-columns:1fr}
      .wide{width:100%}
      .mastline{margin-left:0}
    }
  </style>
</head>
<body>
  <div class="layout">
    <!-- ===== SIDEBAR ===== -->
    <aside class="sidebar">
      <div class="brand">
        <a href="index.html" aria-label="Go to homepage">
          <img src="https://imgur.com/Z5hv7K9.png" alt="SignSense logo">
          <span>SignSense</span>
        </a>
      </div>

      <nav class="nav">
        <a class="active" href="#">
          <img class="arr" src="https://imgur.com/CHGomYz.png" alt="">
          <img class="icon" src="https://imgur.com/lnQTDuo.png" alt="">
          <span>Overview</span>
        </a>
        <a href="index.html">
          <img class="arr" src="https://imgur.com/xhkeG0y.png" alt="">
          <img class="icon" src="https://imgur.com/kE3okdE.png" alt="">
          <span>Home</span>
        </a>
        <a href="#">
          <img class="arr" src="https://imgur.com/xhkeG0y.png" alt="">
          <img class="icon" src="https://imgur.com/krMnFVT.png" alt="">
          <span>Privacy</span>
        </a>
        <a href="#">
          <img class="arr" src="https://imgur.com/xhkeG0y.png" alt="">
          <img class="icon" src="https://imgur.com/6zHviT6.png" alt="">
          <span>Contact Us</span>
        </a>
        <a href="#" id="leaveReview">
          <img class="arr" src="https://imgur.com/xhkeG0y.png" alt="">
          <img class="icon" src="https://imgur.com/zwr9SOe.png" alt="">
          <span>Leave a Review</span>
        </a>
      </nav>

      <div class="push"></div>

      <!-- Only show at page end -->
      <div class="end-only" id="sidebarEnd">
        <div class="copy">Not legal advice.<br/>For informational use only.</div>
        <div class="footer-sep"></div>
        <div class="legal">All rights reserved.</div>
        <div class="copy2">Â© 2025 SignSense</div>
      </div>
    </aside>

    <!-- ===== MAIN ===== -->
    <main class="main">
      <div class="topbar">
        <div class="top-left">
          <div class="top-title">Overview</div>
        </div>
        <div class="lang" aria-haspopup="listbox">
          <div class="lang-btn">Report Language: <strong id="langNow">English</strong></div>
          <div class="lang-menu" id="langMenu" role="listbox" aria-label="Report Language">
            <div class="lang-item" data-lang="English">English</div>
            <div class="lang-item" data-lang="Spanish">Spanish</div>
            <div class="lang-item" data-lang="German">German</div>
            <div class="lang-item" data-lang="French">French</div>
            <div class="lang-item" data-lang="Italian">Italian</div>
            <div class="lang-item" data-lang="Portuguese">Portuguese</div>
            <div class="lang-item" data-lang="Dutch">Dutch</div>
            <div class="lang-item" data-lang="Romanian">Romanian</div>
            <div class="lang-item" data-lang="Albanian">Albanian</div>
            <div class="lang-item" data-lang="Chinese">Chinese</div>
            <div class="lang-item" data-lang="Japanese">Japanese</div>
            <div class="lang-item" data-lang="Turkish">Turkish</div>
          </div>
        </div>
      </div>
      <div class="mastline"></div>

      <div class="grid">
        <!-- LEFT -->
        <div class="left">
          <section class="card">
            <h3><img src="https://imgur.com/CuQFbD7.png" alt="">Summary</h3>
            <div class="list" id="summaryText"></div>
          </section>

          <section class="card meter-block">
            <div class="meter-head">
              <div class="meter-title"><img src="https://imgur.com/nUGfg96.png" alt=""> <span>Confidence to sign freely</span></div>
              <div id="confVal">0%</div>
            </div>
            <div class="meter"><div id="confFill" class="fill"></div></div>
          </section>

          <section class="card meter-block">
            <div class="meter-head">
              <div class="meter-title"><img src="https://imgur.com/UDRuIvO.png" alt=""> <span>Favorability Index</span></div>
              <div id="favVal">0%</div>
            </div>
            <div class="meter"><div id="favFill" class="fill"></div></div>
          </section>

          <section class="card meter-block">
            <div class="meter-head">
              <div class="meter-title"><img src="https://imgur.com/VXZ3kD8.png" alt=""> <span>Deadline pressure</span></div>
              <div id="deadVal">0%</div>
            </div>
            <div class="meter"><div id="deadFill" class="fill"></div></div>
          </section>

          <section class="card" id="issuesCard">
            <h3><img src="https://imgur.com/ppLDtiq.png" alt="">Potential Issues</h3>
            <div class="scroll-y list" id="issuesList"></div>
          </section>

          <section class="card wide">
            <h3><img src="https://imgur.com/EoVDfd5.png" alt="">Smart Suggestions</h3>
            <div class="scroll-y list" id="suggestionsList"></div>
          </section>
        </div>

        <!-- RIGHT -->
        <div class="right">
          <!-- Risk -->
          <section class="card">
            <div class="hcard">
              <div class="circle">
                <svg width="160" height="160">
                  <circle class="track" cx="80" cy="80" r="74"></circle>
                  <circle id="riskArc" class="arc" cx="80" cy="80" r="74"></circle>
                </svg>
                <div class="val" id="riskVal">0%</div>
              </div>
              <div class="htext">
                <h3 style="margin-bottom:0"><img src="https://imgur.com/Myp6Un4.png" alt="">Risk Level</h3>
                <div class="muted" id="riskNote"></div>
                <div class="status"><span class="dot" id="riskDot"></span><span id="riskBadge">Generally Safe</span></div>
              </div>
            </div>
          </section>

          <!-- Clarity -->
          <section class="card">
            <div class="hcard">
              <div class="circle">
                <svg width="160" height="160">
                  <circle class="track" cx="80" cy="80" r="74"></circle>
                  <circle id="clarArc" class="arc" cx="80" cy="80" r="74"></circle>
                </svg>
                <div class="val" id="clarVal">0%</div>
              </div>
              <div class="htext">
                <h3 style="margin-bottom:0"><img src="https://imgur.com/o39xZtC.png" alt="">Clause Clarity</h3>
                <div class="muted" id="clarNote"></div>
                <div class="status"><span class="dot" id="clarDot"></span><span id="clarBadge">Generally Safe</span></div>
              </div>
            </div>
          </section>

          <!-- Clauses -->
          <section class="card" id="clausesCard">
            <h3><img src="https://imgur.com/K04axKU.png" alt="">Main Clauses</h3>
            <div class="list" id="clausesList"></div>
          </section>
        </div>
      </div>
    </main>
  </div>

  <!-- Download (appears near bottom) -->
  <div class="download-wrap" id="dlWrap">
    <button class="download" id="downloadBtn">Download Report</button>
  </div>

  <!-- Email modal -->
  <div class="modal" id="emailModal" aria-modal="true" role="dialog">
    <div class="modal-card">
      <h4>Enter your email to download the PDF report</h4>
      <div class="modal-row">
        <input id="emailInput" class="input" type="email" inputmode="email" placeholder="you@example.com" />
        <button class="btn primary" id="emailSubmit">Download</button>
        <button class="btn" id="emailCancel">Cancel</button>
      </div>
      <div id="emailErr" style="color:#ff6b6b;font-size:13px;margin-top:8px;display:none">Please enter a valid email address.</div>
    </div>
  </div>

<script>
(() => {
  /* ---------- Demo Data: much longer sentences ---------- */
  const demo = {
    summary: [
      "This agreement provides a comprehensive description of services, deliverables, and responsibilities, yet it would benefit from clearer sequencing between milestone acceptance, invoicing triggers, and warranty windows so both teams can anticipate exactly when obligations start and end without room for administrative interpretation.",
      "Overall, the commercial posture is balanced and pragmatic; confidentiality is mutual and intellectual-property ownership is addressed, but the treatment of background tools and improvements should explicitly reserve provider know-how while granting the client broad, perpetual rights to use the outputs within its business without hidden dependencies or unexpected relicensing costs later.",
      "Timeframes are achievable provided the parties confirm decision makers and define acceptance criteria up front; adding a brief grace period before penalties, with clear notice mechanics, reduces unnecessary escalations and keeps schedule pressure aligned with the projectâ€™s real-world risks and dependencies.",
      "Liability is proportionate to fees and excludes indirect damages, which is standard across the industry; still, it can be worth carving out intentional misconduct and data security violations from caps to maintain incentives for diligence while keeping exposure commercially manageable.",
      "Operationally, both sides should agree on a single shared artifact for scope (e.g., a numbered statement of work), where even small updates are versioned, timestamped, and acknowledged to avoid disputes driven by stale drafts or email threads that contradict the canonical record."
    ],
    risk: {
      value: 25,
      note: "Risk is generally low because obligations and exit rights are specific and time-bound; the main watchouts are late-fee compounding during invoice disputes and a one-sided indemnity that could be tuned to reflect proportional responsibility."
    },
    clarity: {
      value: 80,
      note: "Language is plain and readable; however, definitions for material breach, acceptance testing, and data handling could include one or two clarifying sentences to remove ambiguity in edge cases without bloating the contract."
    },
    clauses: [
      "Scope & Deliverables â€” Work is captured at a high level with an exhibit; convert this into a numbered milestone table with objective acceptance tests, so approvals rely on observable outcomes and not subjective preference statements that can stall progress.",
      "Payment Terms â€” Net-30 with monthly penalties that may compound; introduce a seven-day grace period, switch to simple interest, and set a hard cap to keep finance friction predictable during longer approvals or procurement delays.",
      "Intellectual Property â€” Client owns final outputs while provider retains background tools and frameworks; clarify ownership of improvements to those tools and grant the client broad usage rights to avoid accidental transfer or future relicensing.",
      "Confidentiality & Privacy â€” Mutual obligations are standard; add explicit carve-outs for independent development and public information, plus a short security appendix covering encryption, access controls, and deletion timelines where personal data is processed.",
      "Termination â€” Convenience termination with notice and immediate termination for cause are present; define a reasonable cure period for non-critical breaches to reduce accidental exits caused by fixable operational slips."
    ],
    issues: [
      "Compounding late fees can create disproportionate charges during extended procurement or billing disputes; shifting to simple interest with a cap protects the relationship while preserving an incentive to pay on time.",
      "Indemnity is one-sided and uncapped for certain categories; a mutual structure with a commercial cap tied to fees aligns incentives and contains exposure without undermining third-party protections.",
      "Definitions of material breach and acceptance criteria are thin; codifying objective tests and cure periods minimizes the risk of termination over minor defects or quickly resolvable mismatches in expectations.",
      "Data processing references lack specifics on storage location and deletion timelines; a short annex with retention limits and audit cooperation avoids confusion when privacy reviews arise later."
    ],
    suggestions: [
      "Publish a milestone table with measurable acceptance tests and a brief user-testing window, so approvals flow on evidence rather than opinion and teams avoid stalled work while waiting on subjective sign-offs.",
      "Adopt a seven-day grace period before any finance penalties accrue, replace compounding with simple interest, and cap total late charges to a sensible ceiling that both finance teams can plan against without surprises.",
      "Insert a clear definition of material breach and a ten-day cure period for non-critical issues, while carving out truly urgent harms, which reduces termination drama and supports pragmatic course correction.",
      "State that improvements to background tools remain with the provider while granting the client a broad, perpetual, royalty-free license to use deliverables internally, preventing accidental transfers and future relicensing risk.",
      "Add a concise security appendix specifying encryption at rest and in transit, least-privilege access, breach notification timing, and data deletion upon project completion or termination.",
      "Require a single â€˜source of truthâ€™ document for scope (versioned SOW) and mandate written acknowledgment for scope changes, ensuring that email drafts or slide decks do not silently override canonical obligations.",
      "Clarify notice mechanics (email vs. portal, required recipients) so time-based rights like termination, renewals, and fee adjustments are triggered in a predictable and auditable way for both parties.",
      "Specify escalation contacts and weekly status cadence for the first month, which improves alignment and allows early detection of slippage without invoking contractual penalties prematurely."
    ],
    meters:{ confidence:78, favorability:82, deadline:22 }
  };

  let data;
  try{
    const raw = localStorage.getItem('analysisData');
    data = raw ? JSON.parse(raw) : demo;
  }catch(e){ data = demo; }

  /* ---------- Helpers ---------- */
  const $ = s => document.querySelector(s);
  const r = 74; const CIRC = 2*Math.PI*r;
  const cssVar = (v)=>getComputedStyle(document.documentElement).getPropertyValue(v).trim();
  const between = (v,min,max)=>Math.max(min,Math.min(v,max));
  const addP = (el, text) => { const p=document.createElement('p'); p.textContent=text; el.appendChild(p); };

  function colorFor(metric, v){
    if (metric === 'risk') {
      if (v <= 25) return cssVar('--green');
      if (v <= 55) return cssVar('--orange');
      return cssVar('--red');
    }
    if (metric === 'clarity') {
      if (v >= 80) return cssVar('--green');
      if (v >= 45) return cssVar('--orange');
      return cssVar('--red');
    }
    if (metric === 'deadline') {
      if (v <= 25) return cssVar('--green');
      if (v <= 75) return cssVar('--orange');
      return cssVar('--red');
    }
    if (v >= 76) return cssVar('--green');
    if (v >= 50) return cssVar('--orange');
    return cssVar('--red');
  }
  function statusText(metric, v){
    if (metric==='risk'){
      if (v<=25) return "Generally Safe";
      if (v<=55) return "Not Quite Safe";
      return "Not Safe";
    }
    if (metric==='clarity'){
      if (v>=80) return "Generally Safe";
      if (v>=45) return "Not Quite Safe";
      return "Not Safe";
    }
    return "";
  }

  /* ---------- Fill text (longer sentences) ---------- */
  const sBox = $("#summaryText"); sBox.innerHTML="";
  (Array.isArray(data.summary)?data.summary:[String(data.summary)]).forEach(t=>addP(sBox,t));

  function listTo(id, arr){ const el=$(id); el.innerHTML=""; (arr && arr.length?arr:["None"]).forEach(t=>addP(el, t)); }
  listTo("#clausesList", data.clauses);
  listTo("#issuesList", data.issues.concat(data.issues.slice(0,1)));      // make it longer
  // Smart suggestions: make it quite many + longer
  listTo("#suggestionsList", data.suggestions.concat(data.suggestions.slice(0,4)));

  /* ---------- Donuts ---------- */
  function setArc(arcEl, metric, value, valEl, badgeEl, dotEl, noteEl, note){
    const v = between(value||0, 0, 100);
    valEl.textContent = v + "%";
    noteEl.textContent = note || "";
    const color = colorFor(metric, v);
    arcEl.style.stroke = color;
    arcEl.style.strokeDasharray = CIRC;
    arcEl.style.strokeDashoffset = CIRC;
    badgeEl.textContent = statusText(metric, v);
    dotEl.style.background = color;
    requestAnimationFrame(()=>{ arcEl.style.transition="stroke-dashoffset 1s ease"; arcEl.style.strokeDashoffset = CIRC * (1 - v/100); });
  }
  setArc($("#riskArc"), 'risk', data.risk?.value ?? 0, $("#riskVal"), $("#riskBadge"), $("#riskDot"), $("#riskNote"), data.risk?.note);
  setArc($("#clarArc"), 'clarity', data.clarity?.value ?? 0, $("#clarVal"), $("#clarBadge"), $("#clarDot"), $("#clarNote"), data.clarity?.note);

  /* ---------- Bars ---------- */
  function setMeter(fill, label, metric, value){
    const v = between(value||0, 0, 100);
    label.textContent = v + "%";
    fill.style.background = colorFor(metric, v);
    requestAnimationFrame(()=>{ fill.style.width = v + "%"; });
  }
  setMeter($("#confFill"), $("#confVal"), 'confidence', data.meters?.confidence ?? 0);
  setMeter($("#favFill"),  $("#favVal"),  'favorability', data.meters?.favorability ?? 0);
  setMeter($("#deadFill"), $("#deadVal"), 'deadline',    data.meters?.deadline ?? 0);

  /* ---------- Equalize heights for Issues & Clauses ---------- */
  function equalize(){
    const a = $("#issuesCard"), b = $("#clausesCard");
    if(!a || !b) return;
    a.style.minHeight = b.style.minHeight = "auto";
    const h = Math.max(a.getBoundingClientRect().height, b.getBoundingClientRect().height);
    a.style.minHeight = b.style.minHeight = h + "px";
  }
  window.addEventListener("load", equalize);
  window.addEventListener("resize", ()=>setTimeout(equalize, 80));

  /* ---------- Language UI ---------- */
  const langNow = $("#langNow");
  $("#langMenu").querySelectorAll(".lang-item").forEach(li=>{
    li.addEventListener("click", ()=>{ langNow.textContent = li.dataset.lang; });
  });

  /* ---------- Show elements only near bottom ---------- */
  const dlWrap = $("#dlWrap");
  const endBox = $("#sidebarEnd");
  const showThresholdPx = 300; // reveal when ~end of page
  function nearBottom(){
    const scrolledFromBottom = document.documentElement.scrollHeight - (window.scrollY + window.innerHeight);
    const show = scrolledFromBottom <= showThresholdPx;
    dlWrap.style.display = show ? "flex" : "none";
    endBox.style.display = show ? "block" : "none";
  }
  window.addEventListener("scroll", nearBottom, {passive:true});
  window.addEventListener("load", nearBottom);

  /* ---------- Email modal + PDF ---------- */
  const modal = $("#emailModal"), openModal = ()=>modal.style.display="flex", closeModal = ()=>modal.style.display="none";
  $("#downloadBtn").addEventListener("click", openModal);
  $("#emailCancel").addEventListener("click", closeModal);

  function validEmail(e){ return /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test((e||"").trim()); }
  $("#emailSubmit").addEventListener("click", async ()=>{
    const email = $("#emailInput").value || "";
    const err = $("#emailErr");
    if (!validEmail(email)){ err.style.display="block"; return; }
    err.style.display="none";
    await generatePDF("Report", data);
    closeModal();
  });

  async function generatePDF(title, d){
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ unit:"pt", format:"a4" });
    const pageW = doc.internal.pageSize.getWidth();
    const margin = 48, width = pageW - margin*2, lh = 18;

    doc.setFillColor(28,27,34); doc.rect(0,0,pageW,80,'F');
    doc.setTextColor(255,255,255); doc.setFont("helvetica","normal"); doc.setFontSize(18);
    doc.text("SignSense â€” Contract Analysis Report", margin, 48);

    let y = 100;
    const date = new Date().toLocaleString(); doc.setFontSize(10); doc.setTextColor(189,189,189);
    doc.text(`Generated: ${date}`, margin, y); y += lh*1.6;

    y = section("Summary", y); y = bullets(d.summary, y);
    y = section(`Risk Level: ${d.risk?.value ?? 0}%`, y); y = paragraph(d.risk?.note || "", y);
    y = section(`Clause Clarity: ${d.clarity?.value ?? 0}%`, y); y = paragraph(d.clarity?.note || "", y);
    y = section("Main Clauses", y); y = bullets(d.clauses, y, true);
    y = section("Potential Issues", y); y = bullets(d.issues, y);
    y = section("Smart Suggestions", y); y = bullets(d.suggestions, y);
    doc.save("SignSense_Report.pdf");

    function section(t, y){ if (y>780){ doc.addPage(); y=64; } doc.setFont("helvetica","normal"); doc.setTextColor(255,255,255); doc.setFontSize(12); doc.text(t, margin, y); return y+12; }
    function paragraph(text, y){ if(!text) return y; doc.setFont("helvetica","normal"); doc.setTextColor(189,189,189); doc.setFontSize(11); let lines=doc.splitTextToSize(text,width); lines.forEach(line=>{ if(y>780){doc.addPage(); y=64;} doc.text(line, margin, y); y+=lh;}); return y; }
    function bullets(arr,y,allowNewlines=false){ const list=Array.isArray(arr)?arr:[]; doc.setFont("helvetica","normal"); doc.setTextColor(189,189,189); doc.setFontSize(11);
      list.forEach(t=>{ const text = allowNewlines ? t : String(t).replace(/\n+/g,' '); const lines=doc.splitTextToSize(text,width-12);
        if(y>780){doc.addPage(); y=64;} doc.text("â€¢", margin, y);
        lines.forEach((line,i)=>{ if(i===0){doc.text(line, margin+12, y);} else { y+=lh; doc.text(line, margin+12, y);} });
        y+=lh;
      }); return y;
    }
  }

  /* ---------- Review link (placeholder) ---------- */
  $("#leaveReview").addEventListener("click", (e)=>{ e.preventDefault(); alert("Hook this to your reviews form URL."); });
})();
</script>
</body>
</html>
