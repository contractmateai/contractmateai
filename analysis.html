<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>SignSense — Analysis</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <style>
    :root{
      --bg:#0e0c13; --card:#1c1b22; --border:#3b3b3b; --white:#ffffff; --muted:#bdbdbd;
      --green:#00ff65; --orange:#df911a; --red:#fe0000; --black:#000000;
      --radius:21px; --gap:18px; --sidebar:300px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--white);font:400 16px/1.7 Inter,system-ui,Segoe UI,Roboto,Arial}
    .layout{display:grid;grid-template-columns:var(--sidebar) 1fr;min-height:100vh}

    /* ===== SIDEBAR ===== */
    .sidebar{background:#0f0e14;border-right:1px solid var(--border);padding:12px 16px 16px;position:sticky;top:0;height:100vh;display:flex;flex-direction:column;gap:16px}
    .brand{padding:0 2px 0 18px}
    .brand a{display:flex;align-items:center;gap:12px;height:52px;text-decoration:none;color:var(--white)}
    .brand img{width:34px;height:34px}
    .brand span{font-size:24px;color:var(--white);font-weight:400}
    .nav{display:flex;flex-direction:column;gap:10px;margin-top:6px}
    .nav a{text-decoration:none;color:var(--muted);display:flex;align-items:center;gap:16px;padding:16px 18px;border-radius:16px;border:1px solid transparent;transition:border-color .2s ease;font-size:19px;}
    .nav a img.icon{width:30px;height:30px;opacity:.95}
    .nav a img.arr{width:20px;height:20px;opacity:.9}
    .nav a.active{background:#181620;border:1px solid var(--border);color:var(--white)}
    .nav a:hover{background:transparent;border-color:var(--border);color:var(--white)}
    .nav a.active:hover{background:#181620;border-color:var(--border)}
    .push{flex:1}
    .end-only{display:none;opacity:0;transform:translateY(8px)}
    .legal,.copy,.copy2{color:var(--muted);font-size:15px;line-height:1.6}
    .footer-sep{height:1px;background:var(--border);margin:10px 0}

    /* ===== MAIN ===== */
    .main{padding:0 20px 140px;display:grid;grid-template-rows:auto auto 1fr;gap:12px}
    .topbar{position:sticky;top:0;z-index:5;background:var(--bg);display:flex;align-items:flex-end;justify-content:space-between;padding:8px 6px 10px;height:64px;border-bottom:1px solid var(--border)}
    .top-left{display:flex;align-items:center;gap:12px}
    .top-title{font-size:20px;color:var(--white);font-weight:400}

    /* Contract Title row — smaller + muted (per your ask) */
    .doc-title{display:flex;align-items:center;gap:8px;padding:2px 6px 0 6px}
    .doc-title .label{font-size:18px;color:var(--muted);font-weight:400}
    .doc-title .value{font-size:18px;color:var(--muted);font-weight:400}

    /* Language control */
    .lang{position:relative;padding:6px 4px} /* bigger hover hitbox */
    .lang-btn{display:flex;align-items:center;gap:8px;background:transparent;border:none;color:var(--white);font:400 20px/1 Inter;cursor:pointer;padding:6px 10px;min-width:40px;user-select:none}
    .lang-btn #langNow{letter-spacing:.6px}
    .lang-btn .caret{width:0;height:0;border-left:6px solid transparent;border-right:6px solid transparent;border-top:7px solid #fff;opacity:.9}
    .lang-menu{position:absolute;right:0;top:calc(100% + 8px);background:var(--card);border:1px solid var(--border);border-radius:12px;min-width:240px;max-height:260px;overflow:auto;display:none;box-shadow:0 10px 30px rgba(0,0,0,.4);padding:6px;scrollbar-width:thin;scrollbar-color:#6a6a6a transparent}
    .lang.open .lang-menu{display:block}  /* JS-controlled stay-open */
    .lang-menu::-webkit-scrollbar{width:6px}
    .lang-menu::-webkit-scrollbar-thumb{background:#6a6a6a;border-radius:10px}
    .lang-item{display:flex;align-items:center;gap:8px;padding:10px;border-radius:10px;color:var(--white);cursor:pointer}
    .lang-item:hover{background:#17161e}

    /* Grid */
    .grid{display:grid;grid-template-columns:minmax(560px,1.25fr) minmax(560px,1fr);gap:var(--gap);align-items:start;margin-top:6px}
    .left,.right{display:flex;flex-direction:column;gap:var(--gap)}

    /* Fade-in */
    @keyframes fadeIn{to{opacity:1;transform:translateY(0)}}
    .fade-in{animation:fadeIn .8s ease forwards}
    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:18px 18px 20px;opacity:0;transform:translateY(8px)}
    .card h3{margin:0 0 16px;display:flex;align-items:center;gap:12px;font-size:24px;color:var(--white);font-weight:400}
    .card h3 img{width:30px;height:30px}

    .list{display:flex;flex-direction:column;gap:16px}
    .list p{margin:0;color:var(--muted);font-size:20px;overflow-wrap:anywhere;word-break:break-word}
    #summaryText:empty,#issuesList:empty,#suggestionsList:empty,#clausesList:empty{min-height:72px}
    #riskNote:empty,#clarNote:empty{min-height:24px}
    #scoreCard .score-remark:empty{min-height:40px}

    .bullets{margin:0;color:var(--muted);font-size:20px;padding-left:22px;list-style:disc}
    .bullets li{margin:0 0 12px}

    .numbered{counter-reset:item}
    .numbered p{position:relative;padding-left:26px}
    .numbered p::before{counter-increment:item;content:counter(item) ".";position:absolute;left:0;top:0;color:var(--muted)}

    .meter-block{display:flex;flex-direction:column;gap:10px}
    .meter-head{display:flex;align-items:center;justify-content:space-between}
    .meter-title{display:flex;align-items:center;gap:12px;font-size:22px}
    .meter-title img{width:32px;height:32px}
    .meter{height:10px;border-radius:999px;background:var(--black);overflow:hidden}
    .fill{height:100%;width:0%;transition:width 1.6s ease;border-radius:999px}

    .hcard{display:flex;gap:16px;align-items:center}
    .circle{width:160px;height:160px;position:relative;display:grid;place-items:center;flex:0 0 160px}
    .circle svg{transform:rotate(-90deg)}
    .circle .val{position:absolute;font-weight:400;font-size:34px;color:var(--white)}
    .circle circle.track{stroke:var(--black);stroke-width:12;fill:none}
    .circle circle.arc{stroke-width:12;fill:none;stroke-linecap:round;stroke-dasharray:440;stroke-dashoffset:440}
    .htext{flex:1;display:flex;flex-direction:column;gap:8px}
    .muted{color:var(--muted);font-size:18px}
    .status{display:flex;align-items:center;gap:8px;margin-top:8px}
    .status .dot{width:10px;height:10px;border-radius:2px;background:var(--green)}
    .status span{font-size:17px;color:var(--white);font-weight:400}

    #scoreCard{margin-top:12px}
    #confRightCard{margin-top:12px}
    #summaryCard,#riskCard,#clarCard,#profCard,#favCard,#deadCard,#issuesCard,#clausesCard,#suggestionsCard,#scoreCard,#confRightCard{will-change:transform,opacity}

    #scoreCard .score-center{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;text-align:center}
    #scoreCard .score-pct{font-size:42px}
    .score-side{flex:1;display:flex;flex-direction:column;gap:14px}
    .score-remark{font-size:20px;color:var(--muted)}
    .score-bar{position:relative;height:22px;border-radius:14px;background:linear-gradient(90deg,#ff6b6b 0%, #ffd166 45%, #00e676 100%);border:1px solid #2f2f2f;box-shadow:inset 0 1px 0 rgba(255,255,255,.05);width:100%}
    .score-ind{position:absolute;top:-6px;height:34px;width:3px;background:#fff;border-radius:2px;box-shadow:0 0 8px rgba(255,255,255,.6)}
    .score-scale{display:flex;justify-content:space-between;font-size:16px;color:var(--muted)}

    .download-wrap{position:fixed;left:var(--sidebar);right:0;bottom:34px;display:none;justify-content:center;z-index:9;opacity:0;transform:translateY(8px)}
    .download{background:#f2f9fe;color:#000;border:1px solid #cfcfcf;border-radius:16px;padding:18px 32px;display:inline-flex;gap:12px;align-items:center;cursor:pointer;font-weight:400;font-size:19px;box-shadow:0 6px 28px rgba(0,0,0,.28)}
    .download:hover{filter:brightness(1.03)}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:20}
    .modal-card{background:#141319;border:1px solid var(--border);border-radius:18px;padding:18px 18px 16px;width:min(480px,92vw)}
    .modal-card h4{margin:0 0 10px;font-size:18px;font-weight:400}
    .modal-row{display:flex;gap:10px;margin-top:12px}
    .input{flex:1;background:#0f0e14;border:1px solid #5a5a5a;border-radius:10px;padding:12px;color:#fff;font:400 15px/1 Inter}
    .btn{background:#0f0e14;border:1px solid var(--border);color:#fff;border-radius:10px;padding:12px 14px;cursor:pointer}
    .btn.primary{background:#f2f9fe;color:#000;border-color:#cfcfcf}

    @media (max-width:1100px){
      .layout{grid-template-columns:1fr}
      .download-wrap{left:0}
      .grid{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="layout">
    <!-- ===== SIDEBAR ===== -->
    <aside class="sidebar">
      <div class="brand">
        <a href="index.html" aria-label="Go to homepage">
          <img src="https://imgur.com/Z5hv7K9.png" alt="SignSense logo">
          <span>SignSense</span>
        </a>
      </div>

      <nav class="nav">
        <a class="active" href="#"><img class="arr" src="https://imgur.com/CHGomYz.png" alt=""><img class="icon" src="https://imgur.com/lnQTDuo.png" alt=""><span>Overview</span></a>
        <a href="index.html"><img class="arr" src="https://imgur.com/xhkeG0y.png" alt=""><img class="icon" src="https://imgur.com/kE3okdE.png" alt=""><span>Home</span></a>
        <a href="privacy.html"><img class="arr" src="https://imgur.com/xhkeG0y.png" alt=""><img class="icon" src="https://imgur.com/krMnFVT.png" alt=""><span>Privacy</span></a>
        <a href="#"><img class="arr" src="https://imgur.com/xhkeG0y.png" alt=""><img class="icon" src="https://imgur.com/6zHviT6.png" alt=""><span>Contact Us</span></a>
        <a href="#" id="leaveReview"><img class="arr" src="https://imgur.com/xhkeG0y.png" alt=""><img class="icon" src="https://imgur.com/zwr9SOe.png" alt=""><span>Leave a Review</span></a>
      </nav>

      <div class="push"></div>
      <div class="end-only" id="sidebarEnd">
        <div class="legal">All rights reserved.</div>
        <div class="copy2">© 2025 SignSense</div>
        <div class="footer-sep"></div>
        <div class="copy">Not legal advice.<br/>For informational use only.</div>
      </div>
    </aside>

    <!-- ===== MAIN ===== -->
    <main class="main">
      <div class="topbar">
        <div class="top-left"><div class="top-title" id="uiOverview">Overview</div></div>
        <div class="lang" id="lang">
          <button class="lang-btn" id="langBtn" type="button">
            <span id="langNow">EN</span><span class="caret" aria-hidden="true"></span>
          </button>
          <div class="lang-menu" id="langMenu" role="listbox" aria-label="Report Language">
            <div class="lang-item" data-code="en">English</div>
            <div class="lang-item" data-code="it">Italiano</div>
            <div class="lang-item" data-code="de">Deutsch</div>
            <div class="lang-item" data-code="es">Español</div>
            <div class="lang-item" data-code="fr">Français</div>
            <div class="lang-item" data-code="pt">Português</div>
            <div class="lang-item" data-code="nl">Nederlands</div>
            <div class="lang-item" data-code="ro">Română</div>
            <div class="lang-item" data-code="sq">Shqip</div>
            <div class="lang-item" data-code="tr">Türkçe</div>
            <div class="lang-item" data-code="zh">中文</div>
            <div class="lang-item" data-code="ja">日本語</div>
          </div>
        </div>
      </div>

      <!-- Contract title row -->
      <div class="doc-title">
        <span class="label" id="uiTitleLabel">Title:</span>
        <span class="value" id="uiTitleValue">—</span>
      </div>

      <div class="grid">
        <!-- LEFT -->
        <div class="left">
          <section class="card" id="summaryCard">
            <h3><img src="https://imgur.com/CuQFbD7.png" alt=""><span id="uiSummary">Summary</span></h3>
            <div class="list" id="summaryText"></div>
          </section>

          <section class="card meter-block" id="profCard">
            <div class="meter-head">
              <div class="meter-title"><img src="https://imgur.com/EdMAMnx.png" alt=""> <span id="uiProfessionalism">Professionalism</span></div>
              <div id="confVal">0%</div>
            </div>
            <div class="meter"><div id="confFill" class="fill"></div></div>
          </section>

          <section class="card meter-block" id="favCard">
            <div class="meter-head">
              <div class="meter-title"><img src="https://imgur.com/UDRuIvO.png" alt=""> <span id="uiFavorability">Favorability Index</span></div>
              <div id="favVal">0%</div>
            </div>
            <div class="meter"><div id="favFill" class="fill"></div></div>
          </section>

          <section class="card meter-block" id="deadCard">
            <div class="meter-head">
              <div class="meter-title"><img src="https://imgur.com/VXZ3kD8.png" alt=""> <span id="uiDeadline">Deadline pressure</span></div>
              <div id="deadVal">0%</div>
            </div>
            <div class="meter"><div id="deadFill" class="fill"></div></div>
          </section>

          <section class="card" id="issuesCard">
            <h3><img src="https://imgur.com/ppLDtiq.png" alt=""><span id="uiIssues">Potential Issues</span></h3>
            <ul class="bullets" id="issuesList"></ul>
          </section>

          <section class="card" id="suggestionsCard">
            <h3><img src="https://imgur.com/EoVDfd5.png" alt=""><span id="uiSuggestions">Smart Suggestions</span></h3>
            <div class="list numbered" id="suggestionsList"></div>
          </section>
        </div>

        <!-- RIGHT -->
        <div class="right">
          <section class="card" id="riskCard">
            <div class="hcard">
              <div class="circle">
                <svg width="160" height="160" viewBox="0 0 160 160">
                  <circle class="track" cx="80" cy="80" r="74"></circle>
                  <circle id="riskArc" class="arc" cx="80" cy="80" r="74"></circle>
                </svg>
                <div class="val" id="riskVal">0%</div>
              </div>
              <div class="htext">
                <h3 style="margin-bottom:0"><img src="https://imgur.com/Myp6Un4.png" alt=""><span id="uiRisk">Risk Level</span></h3>
                <div class="muted" id="riskNote"></div>
                <div class="status"><span class="dot" id="riskDot"></span><span id="riskBadge">Generally Safe</span></div>
              </div>
            </div>
          </section>

          <section class="card" id="clarCard">
            <div class="hcard">
              <div class="circle">
                <svg width="160" height="160" viewBox="0 0 160 160">
                  <circle class="track" cx="80" cy="80" r="74"></circle>
                  <circle id="clarArc" class="arc" cx="80" cy="80" r="74"></circle>
                </svg>
                <div class="val" id="clarVal">0%</div>
              </div>
              <div class="htext">
                <h3 style="margin-bottom:0"><img src="https://imgur.com/o39xZtC.png" alt=""><span id="uiClarity">Clause Clarity</span></h3>
                <div class="muted" id="clarNote"></div>
                <div class="status"><span class="dot" id="clarDot"></span><span id="clarBadge">Generally Safe</span></div>
              </div>
            </div>
          </section>

          <section class="card" id="clausesCard">
            <h3><img src="https://imgur.com/K04axKU.png" alt=""><span id="uiClauses">Main Clauses</span></h3>
            <div class="list numbered" id="clausesList"></div>
          </section>

          <section class="card" id="scoreCard">
            <div class="hcard">
              <div class="circle">
                <svg width="160" height="160" viewBox="0 0 160 160">
                  <circle class="track" cx="80" cy="80" r="74"></circle>
                  <circle id="scoreArc" class="arc" cx="80" cy="80" r="74"></circle>
                </svg>
                <div class="score-center"><div class="score-pct" id="scorePct">80%</div></div>
              </div>
              <div class="score-side">
                <h3 style="margin-bottom:0"><img src="https://imgur.com/mFvyCj7.png" alt=""><span id="uiScoreChecker">Score Checker</span></h3>
                <div class="score-remark" id="scoreRemark">The contract is nearly perfectly done.</div>
                <div class="score-bar"><span class="score-ind" id="scoreInd"></span></div>
                <div class="score-scale"><span id="uiUnsafe">Unsafe</span><span id="uiSafe">Safe</span><span id="uiVerySafe">Very Safe</span></div>
              </div>
            </div>
          </section>

          <section class="card meter-block" id="confRightCard">
            <div class="meter-head">
              <div class="meter-title"><img src="https://imgur.com/nUGfg96.png" alt=""> <span id="uiConfidence">Confidence to sign freely</span></div>
              <div id="conf2Val">0%</div>
            </div>
            <div class="meter"><div id="conf2Fill" class="fill"></div></div>
          </section>
        </div>
      </div>
    </main>
  </div>

  <div class="download-wrap" id="dlWrap">
    <button class="download" id="downloadBtn">Download Report</button>
  </div>

  <div class="modal" id="emailModal" aria-modal="true" role="dialog">
    <div class="modal-card">
      <h4>Enter your email to download the PDF report</h4>
      <div class="modal-row">
        <input id="emailInput" class="input" type="email" inputmode="email" placeholder="you@example.com" />
        <button class="btn primary" id="emailSubmit">Download</button>
        <button class="btn" id="emailCancel">Cancel</button>
      </div>
      <div id="emailErr" style="color:#ff6b6b;font-size:13px;margin-top:8px;display:none">Please enter a valid email address.</div>
    </div>
  </div>

<script>
(() => {
  // FORCE DEMO MODE (no live payload)
localStorage.setItem("analysisMode","demo"); localStorage.removeItem("analysisRaw");

  /* ================= UI LABELS (i18n) ================= */
  const UI = {
    en:{overview:"Overview",title:"Title:",summary:"Summary",prof:"Professionalism",fav:"Favorability Index",deadline:"Deadline pressure",
        issues:"Potential Issues",suggestions:"Smart Suggestions",risk:"Risk Level",clarity:"Clause Clarity",clauses:"Main Clauses",
        score:"Score Checker",unsafe:"Unsafe",safe:"Safe",verysafe:"Very Safe",conf:"Confidence to sign freely",
        remark:{green:"The contract is nearly perfectly done.",orange:"The contract is done well.",red:"The contract isn’t done well."},
        band:{green:"Totally safe",orange:"Generally safe",red:"Not safe"}},
    it:{overview:"Panoramica",title:"Titolo:",summary:"Sintesi",prof:"Professionalità",fav:"Indice di favorevolezza",deadline:"Pressione delle scadenze",
        issues:"Problemi potenziali",suggestions:"Suggerimenti intelligenti",risk:"Livello di rischio",clarity:"Chiarezza delle clausole",clauses:"Clausole principali",
        score:"Verifica punteggio",unsafe:"Rischioso",safe:"Sicuro",verysafe:"Molto sicuro",conf:"Fiducia nel firmare liberamente",
        remark:{green:"Il contratto è quasi perfetto.",orange:"Il contratto è fatto bene.",red:"Il contratto non è fatto bene."},
        band:{green:"Completamente sicuro",orange:"Generalmente sicuro",red:"Non sicuro"}},
    de:{overview:"Übersicht",title:"Titel:",summary:"Zusammenfassung",prof:"Professionalität",fav:"Günstigkeitsindex",deadline:"Termindruck",
        issues:"Mögliche Probleme",suggestions:"Smarte Vorschläge",risk:"Risikostufe",clarity:"Klausel-Klarheit",clauses:"Wesentliche Klauseln",
        score:"Score-Prüfer",unsafe:"Unsicher",safe:"Sicher",verysafe:"Sehr sicher",conf:"Zuversicht, frei zu unterschreiben",
        remark:{green:"Der Vertrag ist nahezu perfekt.",orange:"Der Vertrag ist gut gemacht.",red:"Der Vertrag ist nicht gut gemacht."},
        band:{green:"Völlig sicher",orange:"Im Allgemeinen sicher",red:"Nicht sicher"}},
    es:{overview:"Resumen",title:"Título:",summary:"Síntesis",prof:"Profesionalidad",fav:"Índice de favorabilidad",deadline:"Presión de plazos",
        issues:"Problemas potenciales",suggestions:"Sugerencias inteligentes",risk:"Nivel de riesgo",clarity:"Claridad de cláusulas",clauses:"Cláusulas principales",
        score:"Comprobador de puntuación",unsafe:"Inseguro",safe:"Seguro",verysafe:"Muy seguro",conf:"Confianza para firmar libremente",
        remark:{green:"El contrato está casi perfecto.",orange:"El contrato está bien hecho.",red:"El contrato no está bien hecho."},
        band:{green:"Totalmente seguro",orange:"Generalmente seguro",red:"No seguro"}},
    fr:{overview:"Aperçu",title:"Titre :",summary:"Résumé",prof:"Professionnalisme",fav:"Indice de favorabilité",deadline:"Pression des délais",
        issues:"Problèmes potentiels",suggestions:"Suggestions intelligentes",risk:"Niveau de risque",clarity:"Clarté des clauses",clauses:"Clauses principales",
        score:"Contrôle du score",unsafe:"Risque",safe:"Sûr",verysafe:"Très sûr",conf:"Confiance pour signer librement",
        remark:{green:"Le contrat est presque parfait.",orange:"Le contrat est bien fait.",red:"Le contrat n’est pas bien fait."},
        band:{green:"Totalement sûr",orange:"Généralement sûr",red:"Pas sûr"}},
    pt:{overview:"Visão geral",title:"Título:",summary:"Resumo",prof:"Profissionalismo",fav:"Índice de favorabilidade",deadline:"Pressão de prazo",
        issues:"Problemas potenciais",suggestions:"Sugestões inteligentes",risk:"Nível de risco",clarity:"Clareza das cláusulas",clauses:"Cláusulas principais",
        score:"Verificador de pontuação",unsafe:"Arriscado",safe:"Seguro",verysafe:"Muito seguro",conf:"Confiança para assinar livremente",
        remark:{green:"O contrato está quase perfeito.",orange:"O contrato está bem elaborado.",red:"O contrato não está bem elaborado."},
        band:{green:"Totalmente seguro",orange:"Geralmente seguro",red:"Não seguro"}},
    nl:{overview:"Overzicht",title:"Titel:",summary:"Samenvatting",prof:"Professionaliteit",fav:"Voordeligheidsindex",deadline:"Deadline-druk",
        issues:"Potentiële problemen",suggestions:"Slimme suggesties",risk:"Risiconiveau",clarity:"Duidelijkheid van clausules",clauses:"Belangrijkste clausules",
        score:"Scorecontrole",unsafe:"Onveilig",safe:"Veilig",verysafe:"Zeer veilig",conf:"Vertrouwen om vrij te ondertekenen",
        remark:{green:"Het contract is bijna perfect.",orange:"Het contract is goed opgesteld.",red:"Het contract is niet goed opgesteld."},
        band:{green:"Helemaal veilig",orange:"Over het algemeen veilig",red:"Niet veilig"}},
    ro:{overview:"Prezentare",title:"Titlu:",summary:"Rezumat",prof:"Profesionalism",fav:"Indice de favorabilitate",deadline:"Presiunea termenelor",
        issues:"Probleme potențiale",suggestions:"Sugestii inteligente",risk:"Nivel de risc",clarity:"Claritatea clauzelor",clauses:"Clauze principale",
        score:"Verificator de scor",unsafe:"Nesigur",safe:"Sigur",verysafe:"Foarte sigur",conf:"Încredere de a semna liber",
        remark:{green:"Contractul este aproape perfect.",orange:"Contractul este bine realizat.",red:"Contractul nu este bine realizat."},
        band:{green:"Complet sigur",orange:"În general sigur",red:"Nesigur"}},
    sq:{overview:"Përmbledhje",title:"Titulli:",summary:"Përmbledhje",prof:"Profesionalizmi",fav:"Indeksi i favorshmërisë",deadline:"Presioni i afateve",
        issues:"Çështje të mundshme",suggestions:"Sugjerime të zgjuara",risk:"Niveli i rrezikut",clarity:"Qartësia e klauzolave",clauses:"Klauzolat kryesore",
        score:"Kontrolluesi i pikëve",unsafe:"E pasigurt",safe:"E sigurt",verysafe:"Shumë e sigurt",conf:"Besimi për të firmosur lirshëm",
        remark:{green:"Kontrata është pothuajse perfekte.",orange:"Kontrata është bërë mirë.",red:"Kontrata nuk është bërë mirë."},
        band:{green:"Plotësisht e sigurt",orange:"Në përgjithësi e sigurt",red:"Jo e sigurt"}},
    tr:{overview:"Genel bakış",title:"Başlık:",summary:"Özet",prof:"Profesyonellik",fav:"Elverişlilik Endeksi",deadline:"Zaman baskısı",
        issues:"Olası sorunlar",suggestions:"Akıllı öneriler",risk:"Risk seviyesi",clarity:"Hüküm açıklığı",clauses:"Ana hükümler",
        score:"Puan denetleyici",unsafe:"Güvensiz",safe:"Güvenli",verysafe:"Çok güvenli",conf:"Özgürce imzalama güveni",
        remark:{green:"Sözleşme neredeyse kusursuz.",orange:"Sözleşme iyi hazırlanmış.",red:"Sözleşme iyi hazırlanmış değil."},
        band:{green:"Tamamen güvenli",orange:"Genel olarak güvenli",red:"Güvenli değil"}},
    ja:{overview:"概要",title:"タイトル：",summary:"要約",prof:"プロ意識",fav:"有利性指数",deadline:"締切プレッシャー",
        issues:"潜在的な問題",suggestions:"スマート提案",risk:"リスク水準",clarity:"条項の明確さ",clauses:"主要条項",
        score:"スコア確認",unsafe:"危険",safe:"安全",verysafe:"非常に安全",conf:"自由に署名できる自信",
        remark:{green:"契約はほぼ完璧です。",orange:"契約は良くできています。",red:"契約は十分ではありません。"},
        band:{green:"完全に安全",orange:"概ね安全",red:"安全ではない"}},
    zh:{overview:"概览",title:"标题：",summary:"摘要",prof:"专业性",fav:"有利指数",deadline:"期限压力",
        issues:"潜在问题",suggestions:"智能建议",risk:"风险等级",clarity:"条款清晰度",clauses:"主要条款",
        score:"评分检查",unsafe:"不安全",safe:"安全",verysafe:"非常安全",conf:"自由签署的信心",
        remark:{green:"合同几乎完美。",orange:"合同完成得很好。",red:"合同完成得不好。"},
        band:{green:"完全安全",orange:"总体安全",red:"不安全"}}
  };

  /* ============== DATA: live (localStorage) -> fallback demo ============== */
/* ============== DATA: live (localStorage) -> fallback demo ============== */
const fallbackDemo = {
  meta: { title: "Sample Agreement", detectedLang: "en" },
  summary: [
    "The Vienna Convention establishes a framework for international sales contracts between parties from different countries.",
    "It outlines the rights and obligations of buyers and sellers, including provisions for contract formation, delivery, and liability.",
    "The Convention aims to promote uniformity in international trade and reduce legal barriers."
  ],
  risk: {
    value: 45,
    note: "The contract is generally safe, with clear provisions for both parties."
  },
  clarity: {
    value: 70,
    note: "The clauses are generally clear and well-structured, facilitating understanding."
  },
  clauses: [
    "The Convention applies to contracts for the sale of goods between parties whose places of business are in different countries.",
    "Parties may exclude the application of the Convention or derogate from its provisions.",
    "The seller must deliver goods that conform to the contract in terms of quantity, quality, and packaging.",
    "The buyer must pay the price and take delivery of the goods as stipulated in the contract.",
    "In case of non-compliance, the aggrieved party has the right to seek damages or terminate the contract."
  ],
  issues: [
    "Parties may not fully understand their rights and obligations under the Convention, leading to disputes.",
    "Exclusions or modifications to the Convention's provisions may create legal uncertainties.",
    "The lack of clarity in certain terms could lead to differing interpretations between parties.",
    "The Convention does not cover all aspects of sales, such as liability for personal injury or property damage.",
    "Parties must ensure compliance with local laws that may affect the enforceability of the contract."
  ],
  suggestions: [
    "Consider including a clause that specifies the governing law for any disputes, e.g., 'This contract shall be governed by the laws of Italy.'",
    "Ensure that all parties fully understand the implications of excluding any provisions of the Convention, e.g., 'Parties may opt-out of certain liability clauses.'",
    "Include a clear dispute resolution mechanism, e.g., 'Any disputes arising from this contract shall be resolved through arbitration in Vienna.'"
  ],
  meters: {
    professionalism: 65,
    favorability: 50,
    deadline: 40,
    confidence: 70
  },
  translations: {} // demo uses English; UI falls back correctly
};

 const normalized = fallbackDemo;

  /* ================== Helpers ================== */
  const $ = s => document.querySelector(s);
  const cssVar = v => getComputedStyle(document.documentElement).getPropertyValue(v).trim();
  const clamp01 = v => Math.max(0,Math.min(100,Number(v||0)));
  const addP = (el, t)=>{const p=document.createElement('p');p.textContent=t;el.appendChild(p);};
  const colorFor=(metric,v)=>{
    if(metric==='risk')     return v<=25?cssVar('--green'):v<=58?cssVar('--orange'):cssVar('--red');
    if(metric==='clarity')  return v>=78?cssVar('--green'):v>=49?cssVar('--orange'):cssVar('--red');
    if(metric==='deadline') return v<=35?cssVar('--green'):v<=68?cssVar('--orange'):cssVar('--red');
    return v>=75?cssVar('--green'):v>=49?cssVar('--orange'):cssVar('--red');
  };
  const bandFor=(metric,v)=>{
    if(metric==='risk')     return v<=25?'green':v<=58?'orange':'red';
    if(metric==='clarity')  return v>=78?'green':v>=49?'orange':'red';
    return v>=75?'green':v>=49?'orange':'red';
  };

  /* ============== Language & content selection ============== */
  const supported = Object.keys(UI);
  const detectedLang = normalized.meta.detectedLang;
  let currentLang = supported.includes(detectedLang) ? detectedLang : "en";

  function renderUILabels(lang){
    const t = UI[lang] || UI.en;
    $("#uiOverview").textContent = t.overview;
    $("#uiTitleLabel").textContent = t.title;
    $("#uiSummary").textContent = t.summary;
    $("#uiProfessionalism").textContent = t.prof;
    $("#uiFavorability").textContent = t.fav;
    $("#uiDeadline").textContent = t.deadline;
    $("#uiIssues").textContent = t.issues;
    $("#uiSuggestions").textContent = t.suggestions;
    $("#uiRisk").textContent = t.risk;
    $("#uiClarity").textContent = t.clarity;
    $("#uiClauses").textContent = t.clauses;
    $("#uiScoreChecker").textContent = t.score;
    $("#uiUnsafe").textContent = t.unsafe;
    $("#uiSafe").textContent = t.safe;
    $("#uiVerySafe").textContent = t.verysafe;
    /* NEW: translate Confidence label */
    const confLabel = document.getElementById("uiConfidence");
    if (confLabel) confLabel.textContent = t.conf;
  }

  function sanitizeNote(s){ const v=(s||"").trim(); return (v==="string"||v==="…") ? "" : v; }

  function getLocalizedContent(lang){
    const tr = normalized.translations || {};
    const seg = tr[lang] || {};
    const localizedTitle = (typeof seg.title === "string" && seg.title.trim())
      ? seg.title.trim()
      : normalized.meta.title;
    return {
      /* NEW: title uses translation if provided */
      title: localizedTitle,
      summary: Array.isArray(seg.summary)&&seg.summary.length ? seg.summary : normalized.summary,
      clauses: Array.isArray(seg.mainClauses)&&seg.mainClauses.length ? seg.mainClauses : normalized.clauses,
      issues: Array.isArray(seg.potentialIssues)&&seg.potentialIssues.length ? seg.potentialIssues : normalized.issues,
      suggestions: Array.isArray(seg.smartSuggestions)&&seg.smartSuggestions.length ? seg.smartSuggestions : normalized.suggestions,
      risk: { value: normalized.risk.value, note: sanitizeNote(typeof seg.riskNote==="string"?seg.riskNote:normalized.risk.note) },
      clarity: { value: normalized.clarity.value, note: sanitizeNote(typeof seg.clarityNote==="string"?seg.clarityNote:normalized.clarity.note) }
    };
  }

  function setArc(arcEl, metric, value, valEl){
    const v=clamp01(value); const rr=parseFloat(arcEl.getAttribute('r'))||74;
    const circ=2*Math.PI*rr;
    arcEl.style.stroke=colorFor(metric,v);
    arcEl.style.strokeDasharray=circ; arcEl.style.strokeDashoffset=circ;
    requestAnimationFrame(()=>{ arcEl.style.transition="stroke-dashoffset 1.8s ease"; arcEl.style.strokeDashoffset=circ*(1-v/100); });
    if(valEl) valEl.textContent=v+"%";
  }
  function setMeter(fillEl, labelEl, metric, value){
    const v=clamp01(value); labelEl.textContent=v+"%";
    fillEl.style.background=colorFor(metric,v);
    requestAnimationFrame(()=>{ fillEl.style.width=v+"%"; });
  }

  function renderAll(lang){
    renderUILabels(lang);
    $("#langNow").textContent = lang.toUpperCase();

    const data = getLocalizedContent(lang);

    $("#uiTitleValue").textContent = data.title || "—";

    const sBox=$("#summaryText"); sBox.innerHTML="";
    (Array.isArray(data.summary)?data.summary:[String(data.summary)]).forEach(t=>addP(sBox,t));

    const cl=$("#clausesList"); cl.innerHTML=""; (data.clauses||[]).forEach(t=>addP(cl,t));
    const il=$("#issuesList");  il.innerHTML=""; (data.issues||[]).forEach(t=>{const li=document.createElement('li'); li.textContent=t; il.appendChild(li);});
    const sl=$("#suggestionsList"); sl.innerHTML=""; (data.suggestions||[]).forEach(t=>addP(sl,t));

    const riskVal = clamp01(data.risk.value), clarVal = clamp01(data.clarity.value);
    setArc($("#riskArc"), 'risk', riskVal, $("#riskVal"));
    setArc($("#clarArc"), 'clarity', clarVal, $("#clarVal"));
    $("#riskNote").textContent = data.risk.note || "";
    $("#clarNote").textContent = data.clarity.note || "";

    const rBand = bandFor('risk', riskVal), cBand = bandFor('clarity', clarVal);
    $("#riskDot").style.background = colorFor('risk', riskVal);
    $("#clarDot").style.background = colorFor('clarity', clarVal);
    const t = UI[lang] || UI.en;
    $("#riskBadge").textContent = t.band[rBand];
    $("#clarBadge").textContent = t.band[cBand];

    setArc($("#scoreArc"), 'clarity', clarVal);
    $("#scorePct").textContent = clarVal + "%";
    $("#scoreInd").style.left = `calc(${clarVal}% - 1.5px)`;
    $("#scoreRemark").textContent = (clarVal>=78) ? t.remark.green : (clarVal>=49) ? t.remark.orange : t.remark.red;

    setMeter($("#confFill"), $("#confVal"), 'professionalism', normalized.meters.professionalism);
    setMeter($("#favFill"),  $("#favVal"),  'favorability',    normalized.meters.favorability);
    setMeter($("#deadFill"), $("#deadVal"), 'deadline',        normalized.meters.deadline);
    setMeter($("#conf2Fill"),$("#conf2Val"),'confidence',      normalized.meters.confidence);
  }

  /* ======= Init render ======= */
  renderAll(currentLang);

  /* ======= HOVER STAY-OPEN DROPDOWN (no click needed) ======= */
  const langBox = document.getElementById("lang");
  let closeTimer=null;
  const openMenu = ()=>{ clearTimeout(closeTimer); langBox.classList.add("open"); };
  const scheduleClose = ()=>{ clearTimeout(closeTimer); closeTimer=setTimeout(()=>langBox.classList.remove("open"), 140); };
  ["mouseenter","mousemove"].forEach(ev=>langBox.addEventListener(ev, openMenu));
  langBox.addEventListener("mouseleave", scheduleClose);
  document.querySelectorAll(".lang-item").forEach(item=>{
    item.addEventListener("click", ()=>{
      const code=item.getAttribute("data-code"); if(!code) return;
      currentLang = code; renderAll(currentLang);
      scheduleClose();
    });
  });

  /* ======= Reveal animations ======= */
  window.addEventListener('load', () => {
    ["#summaryCard","#riskCard","#clarCard"].forEach(sel => { const el=$(sel); if(el){el.classList.add('fade-in');}});
    setTimeout(()=>["#profCard","#favCard","#deadCard","#issuesCard","#clausesCard"].forEach(sel=>{const el=$(sel); if(el){el.classList.add('fade-in');}}), 180);
  });
  const io = new IntersectionObserver((entries)=>{ entries.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('fade-in'); io.unobserve(e.target);} });},{ threshold: .18 });
  ["#suggestionsCard","#scoreCard","#confRightCard"].forEach(sel=>{ const el=$(sel); if(el){ io.observe(el); } });

  /* ======= Download modal & PDF ======= */
  const dlWrap=$("#dlWrap"), endBox=$("#sidebarEnd");
  function nearBottom(){ const s=document.documentElement.scrollHeight-(window.scrollY+window.innerHeight); const show=s<=300;
    dlWrap.style.display=show?"flex":"none"; endBox.style.display=show?"block":"none";
    if(show){ dlWrap.classList.add('fade-in'); endBox.classList.add('fade-in'); } }
  window.addEventListener("scroll", nearBottom, {passive:true}); window.addEventListener("load", nearBottom);

  const modal=$("#emailModal"), openModal=()=>modal.style.display="flex", closeModal=()=>modal.style.display="none";
  $("#downloadBtn").addEventListener("click", openModal);
  $("#emailCancel").addEventListener("click", closeModal);
  const validEmail = e => /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test((e||"").trim());
  $("#emailSubmit").addEventListener("click", async ()=>{
    const email=$("#emailInput").value||"", err=$("#emailErr");
    if(!validEmail(email)){ err.style.display="block"; return; }
    err.style.display="none"; const lang=currentLang; const data = getLocalizedContent(lang);
    await generatePDF("Report", data, lang); closeModal();
  });

<script>
/* ====== Poppins loader for jsPDF (Regular + Bold) ====== */
async function ensurePoppins(doc){
  // Skip if already registered
  if (doc.getFontList && doc.getFontList()['Poppins']) return;

  // Public TTFs from Google Fonts repo via jsDelivr (OFL-licensed)
  const REG_URL = "https://cdn.jsdelivr.net/gh/google/fonts/ofl/poppins/Poppins-Regular.ttf";
  const BLD_URL = "https://cdn.jsdelivr.net/gh/google/fonts/ofl/poppins/Poppins-Bold.ttf";

  async function fetchAsBase64(url){
    const r = await fetch(url, {mode:"cors"});
    const buf = await r.arrayBuffer();
    // Convert to base64
    let binary = "";
    const bytes = new Uint8Array(buf);
    const len = bytes.byteLength;
    for (let i = 0; i < len; i++) binary += String.fromCharCode(bytes[i]);
    return btoa(binary);
  }

  const [regB64, boldB64] = await Promise.all([
    fetchAsBase64(REG_URL),
    fetchAsBase64(BLD_URL)
  ]);

  // Register with jsPDF
  doc.addFileToVFS("Poppins-Regular.ttf", regB64);
  doc.addFont("Poppins-Regular.ttf", "Poppins", "normal");

  doc.addFileToVFS("Poppins-Bold.ttf", boldB64);
  doc.addFont("Poppins-Bold.ttf", "Poppins", "bold");
}

/* === icons & marks you specified === */
const ASSETS = {
  logo:       "https://imgur.com/aRIGT9V.png",
  risk:       "https://imgur.com/hSkzUQu.png",
  clarity:    "https://imgur.com/3J3mzur.png",
  pro:        "https://imgur.com/FLqsaQJ.png",
  fav:        "https://imgur.com/GIAYFBC.png",
  dead:       "https://imgur.com/BbyV5gF.png",
  score:      "https://imgur.com/H47wt5e.png",
  confidence: "https://imgur.com/GzPeaz5.png"
};

/* === small helper: image URL -> dataURL so jsPDF can embed === */
async function imgToDataURL(url){
  const img = new Image();
  img.crossOrigin = "anonymous";
  img.src = url;
  await new Promise((res, rej)=>{ img.onload = res; img.onerror = rej; });
  const c = document.createElement("canvas");
  c.width = img.naturalWidth; c.height = img.naturalHeight;
  c.getContext("2d").drawImage(img, 0, 0);
  return c.toDataURL("image/png");
}

/* ================= Main generator (Poppins everywhere) ================= */
async function generatePDF(filename, d, lang){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit: "pt", format: "a4" });
  await ensurePoppins(doc);               // ← ensure font is ready

  const FONT = "Poppins";                 // ← use Poppins
  const REG = "normal";
  const B   = "bold";

  const W = doc.internal.pageSize.getWidth();
  const H = doc.internal.pageSize.getHeight();

  // preload icons
  const IM = {};
  for (const k in ASSETS) IM[k] = await imgToDataURL(ASSETS[k]);

  // utils
  const M = 38;
  const H2  = (t,y)=>{ doc.setFont(FONT,B); doc.setFontSize(18); doc.setTextColor(0,0,0); doc.text(t, M, y); };
  const P   = (t,y,w,lineH=16)=>{ doc.setFont(FONT,REG); doc.setFontSize(11); doc.setTextColor(30,30,30);
    const lines = doc.splitTextToSize(t,w);
    lines.forEach(line=>{ doc.text(line, M+14, y); y+=lineH; }); return y; };
  const bulletList = (arr,y,w,lineH=16)=>{ doc.setFont(FONT,REG); doc.setFontSize(11); doc.setTextColor(30,30,30);
    (arr||[]).forEach(item=>{
      const lines = doc.splitTextToSize(String(item), w-16);
      doc.text("•", M+10, y); doc.text(lines[0], M+22, y);
      for (let i=1;i<lines.length;i++){ y+=lineH; doc.text(lines[i], M+22, y); }
      y+=lineH;
    }); return y; };
  const roundedRect = (x,y,w,h,r=12, mode='S', border=3)=>{ doc.setDrawColor(0,0,0); doc.setLineWidth(border); doc.roundedRect(x,y,w,h,r,r,mode); };
  const blackBorderBox = (x,y,w,h)=> roundedRect(x,y,w,h,12,"S",3);

  function header(){
    doc.setFillColor(0,0,0); doc.rect(0,0,W,120,"F");
    doc.setTextColor(255,255,255);
    doc.setFont(FONT,REG); doc.setFontSize(46); doc.text("Contract Report", M, 72);
    doc.setFont(FONT,REG); doc.setFontSize(14);
    const dt = new Date();
    const day = dt.getDate().toString().padStart(2,"0");
    const month = dt.toLocaleString('en', { month:'long' });
    const year = dt.getFullYear();
    doc.text(`Generated on ${day} ${month} ${year}`, M, 102);
  }

  function footer(pageNo){
    // page chip
    doc.setFillColor(0,0,0);
    doc.roundedRect(M, H-54, 96, 30, 10, 10, "F");
    doc.setTextColor(255,255,255); doc.setFont(FONT,B); doc.setFontSize(12);
    doc.text(`PAGE ${pageNo}`, M+20, H-34);

    // logo (above corner text)
    doc.addImage(IM.logo, "PNG", W-140, H-84, 110, 30);

    // disclaimer (underlined, NOT bold)
    const y = H-16, prefix = "Kindly keep in mind that although you might find this report helpful, this is ",
          suffix = " legal advice.";
    doc.setTextColor(30,30,30); doc.setFont(FONT,REG); doc.setFontSize(10);
    let x = M; doc.text(prefix, x, y); x += doc.getTextWidth(prefix);
    doc.setFont(FONT,B); const notW = doc.getTextWidth("not");
    doc.text("not", x, y);
    doc.setLineWidth(0.8); doc.line(x, y+2, x+notW, y+2);
    x += notW; doc.setFont(FONT,REG); doc.text(suffix, x, y);
    // underline whole sentence
    doc.line(M, y+2, x + doc.getTextWidth(suffix), y+2);
  }

  /* ===================== PAGE 1 ===================== */
  header();
  let y = 140;

  // Title row
  doc.setTextColor(0,0,0);
  doc.setFont(FONT,B); doc.setFontSize(14); doc.text("Title:", M, y);
  doc.setFont(FONT,REG); doc.text(` ${d.title || "—"}`, M+40, y);
  y += 20;

  // Summary bordered box
  const sumTop = y + 8;
  H2("Summary of Contract:", y); y += 10;
  const boxTextY = y + 22;
  const summaryStr = (Array.isArray(d.summary) ? d.summary : [d.summary]).join("\n\n");
  let yMeasure = P(summaryStr, boxTextY, W - (M*2) - 28);
  const sumH = (yMeasure - boxTextY) + 34;
  blackBorderBox(M-6, sumTop, W - (M*2) + 12, sumH);
  y = sumTop + sumH + 28;

  // Percentage Breakdown (2 cards)
  doc.setFont(FONT,B); doc.setFontSize(16); doc.text("Percentage Breakdown", M, y);
  y += 16;
  const cardW = (W - M*2 - 16) / 2;
  const rowY = y + 12;

  // Risk Level card
  let box1Y = rowY, box1H = 120;
  blackBorderBox(M, box1Y, cardW, box1H);
  doc.addImage(IM.risk,"PNG", M+14, box1Y+14, 26, 26);
  doc.setFont(FONT,B); doc.setFontSize(14); doc.text("Risk Level", M+48, box1Y+32);
  doc.setFontSize(32); doc.text(`${(d.risk?.value ?? 0)}%`, M+24, box1Y+84);
  doc.setFont(FONT,REG); doc.setFontSize(11);
  doc.text("Clear terms overall, but", M+110, box1Y+66);
  doc.text("missing late fees and",     M+110, box1Y+82);
  doc.text("dispute process.",          M+110, box1Y+98);
  doc.setFillColor(230,255,230); roundedRect(M+24, box1Y+94, 118, 20, 8, "F", 1.2);
  doc.setFont(FONT,REG); doc.setTextColor(0,110,0); doc.setFontSize(11); doc.text("Generally Safe", M+34, box1Y+108);
  doc.setTextColor(0,0,0);

  // Clause Clarity card
  const cardX2 = M + cardW + 16;
  blackBorderBox(cardX2, box1Y, cardW, box1H);
  doc.addImage(IM.clarity,"PNG", cardX2+14, box1Y+14, 26, 26);
  doc.setFont(FONT,B); doc.setFontSize(14); doc.text("Clause Clarity", cardX2+48, box1Y+32);
  doc.setFontSize(32); doc.text(`${(d.clarity?.value ?? 0)}%`, cardX2+24, box1Y+84);
  doc.setFont(FONT,REG); doc.setFontSize(11);
  doc.text("Plain language used, but", cardX2+110, box1Y+66);
  doc.text("some clauses need",       cardX2+110, box1Y+82);
  doc.text("clearer detail.",         cardX2+110, box1Y+98);
  doc.setFillColor(230,255,230); roundedRect(cardX2+24, box1Y+94, 118, 20, 8, "F", 1.2);
  doc.setFont(FONT,REG); doc.setTextColor(0,110,0); doc.setFontSize(11); doc.text("Generally Safe", cardX2+34, box1Y+108);
  doc.setTextColor(0,0,0);

  y = box1Y + box1H + 28;

  // Statistical Bars
  doc.setFont(FONT,B); doc.setFontSize(16); doc.text("Statistical Bars", M, y);
  y += 14;

  function statBar(label, icon, value, yBar){
    const barH = 34, barW = W - (M*2) - 12, x = M;
    blackBorderBox(x, yBar, barW, barH);
    doc.addImage(icon, "PNG", x+10, yBar+6, 22, 22);
    doc.setFont(FONT,B); doc.setFontSize(12); doc.text(label, x+40, yBar+22);
    // % right
    const pct = `${value}%`; const tx = x + barW - 40 - doc.getTextWidth(pct);
    doc.text(pct, tx, yBar+22);
    // inner fill
    const innerW = barW - 14, innerX = x+7;
    doc.setFillColor(160, 235, 160);
    doc.roundedRect(innerX, yBar+barH-16, (innerW*value)/100, 10, 5, 5, "F");
  }
  statBar("Professionalism", IM.pro, (d.meters?.professionalism??65), y); y += 46;
  statBar("Favorability Index", IM.fav, (d.meters?.favorability??50), y); y += 46;
  statBar("Deadline Pressure", IM.dead, (d.meters?.deadline??40), y); y += 58;

  // Main Clauses
  doc.setFont(FONT,B); doc.setFontSize(16); doc.text("Main Clauses", M, y);
  const mcBoxY = y - 8, mcTextY = y + 14;
  let yMC = bulletList(d.clauses||[], mcTextY, W - (M*2) - 28);
  const mcH = (yMC - mcTextY) + 34;
  blackBorderBox(M-6, mcBoxY, W - (M*2) + 12, mcH);
  y = mcBoxY + mcH + 16;

  footer(1);

  /* ===================== PAGE 2 ===================== */
  doc.addPage();
  header();
  y = 140;

  // Potential Issues
  doc.setFont(FONT,B); doc.setFontSize(16); doc.text("Potential Issues that might occur", M, y);
  const piBoxY = y - 8, piTextY = y + 14;
  let yPI = bulletList(d.issues||[], piTextY, W - (M*2) - 28);
  const piH = (yPI - piTextY) + 34;
  blackBorderBox(M-6, piBoxY, W - (M*2) + 12, piH);
  y = piBoxY + piH + 24;

  // Smart Suggestions
  doc.setFont(FONT,B); doc.setFontSize(16); doc.text("Smart Suggestions", M, y);
  const ssBoxY = y - 8, ssTextY = y + 14;
  let ySS = ssTextY;
  const suggestions = Array.isArray(d.suggestions)? d.suggestions : [];
  doc.setFont(FONT,REG); doc.setFontSize(11); doc.setTextColor(30,30,30);
  suggestions.forEach((s, i) => {
    const num = `${i+1}. `, wNum = doc.getTextWidth(num);
    const lines = doc.splitTextToSize(String(s), W - (M*2) - 28 - wNum);
    doc.text(num, M+14, ySS); doc.text(lines[0], M+14 + wNum, ySS);
    for (let k=1;k<lines.length;k++){ ySS += 16; doc.text(lines[k], M+14 + wNum, ySS); }
    ySS += 22;
  });
  const ssH = (ySS - ssTextY) + 20;
  blackBorderBox(M-6, ssBoxY, W - (M*2) + 12, ssH);
  y = ssBoxY + ssH + 24;

  // Bottom row: Score Checker + Confidence
  const leftW = (W - M*2 - 16) * 0.58;
  const rightW = (W - M*2 - 16) - leftW;
  const scX = M, scY = y, scH = 162;
  blackBorderBox(scX, scY, leftW, scH);
  doc.addImage(IM.score,"PNG", scX+14, scY+14, 26, 26);
  doc.setFont(FONT,B); doc.setFontSize(14); doc.setTextColor(0,0,0);
  doc.text("Score Checker", scX+48, scY+32);
  doc.setFont(FONT,B); doc.setFontSize(34);
  const scorePct = (d.clarity?.value ?? 0);
  doc.text(`${scorePct}%`, scX+24, scY+84);
  doc.setFont(FONT,REG); doc.setFontSize(11);
  doc.text("The contract is nearly perfectly done.", scX+24, scY+108);
  doc.setDrawColor(47,47,47); doc.setLineWidth(1.2);
  doc.roundedRect(scX+24, scY+124, leftW-48, 22, 10, 10, "S");
  const indX = scX+24 + (leftW-48) * (scorePct/100);
  doc.setFillColor(0,0,0); doc.rect(indX-1.5, scY+118, 3, 34, "F");
  doc.setFontSize(10); doc.setTextColor(90,90,90);
  doc.text("Unsafe", scX+24, scY+166);
  const safeW = doc.getTextWidth("Safe"); doc.text("Safe", scX + 24 + (leftW-48)/2 - safeW/2, scY+166);
  const vsW = doc.getTextWidth("Very Safe"); doc.text("Very Safe", scX + 24 + (leftW-48) - vsW, scY+166);
  doc.setTextColor(0,0,0);

  // Confidence to sign freely
  const cfX = scX + leftW + 16, cfY = scY, cfH = scH;
  blackBorderBox(cfX, cfY, rightW, cfH);
  doc.addImage(IM.confidence,"PNG", cfX+14, cfY+14, 26, 26);
  doc.setFont(FONT,B); doc.setFontSize(14); doc.text("Confidence to sign freely", cfX+48, cfY+32);
  const mX = cfX+24, mY = cfY+74, mW = rightW-48, mH = 22;
  blackBorderBox(mX-2, mY-2, mW+4, mH+4);
  const confV = (d.meters?.confidence ?? 70);
  doc.setFillColor(255, 200, 0); doc.rect(mX, mY, mW * (confV/100), mH, "F");
  doc.setFont(FONT,B); doc.setFontSize(12);
  const confTxt = `${confV}%`; const confTx = mX + mW - 6 - doc.getTextWidth(confTxt);
  doc.text(confTxt, confTx, mY - 8);

  // © line near bottom-right (above logo), then footer
  doc.setTextColor(0,0,0); doc.setFont(FONT, REG); doc.setFontSize(10);
  doc.text("© 2025 SignSense. All rights reserved.", W-248, H-54);
  footer(2);

  doc.save((filename || "SignSense_Report") + ".pdf");
}
</script>

})();
</script>
</body>
</html>

