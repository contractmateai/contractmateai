<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>SignSense — Analysis</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <style>
    :root{
      --bg:#0e0c13;
      --card:#1c1b22;
      --border:#3b3b3b;
      --white:#ffffff;
      --muted:#bdbdbd;
      --green:#00ff65;
      --orange:#df911a;
      --red:#fe0000;
      --black:#000000;
      --radius:21px;
      --gap:18px;
      --sidebar:300px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--white);font:400 16px/1.7 Inter,system-ui,Segoe UI,Roboto,Arial}
    .layout{display:grid;grid-template-columns:var(--sidebar) 1fr;min-height:100vh}

    /* ===== SIDEBAR ===== */
    .sidebar{
      background:#0f0e14;border-right:1px solid var(--border);
      padding:12px 16px 16px;position:sticky;top:0;height:100vh;display:flex;flex-direction:column;gap:16px
    }
    .brand{padding:0 2px 0 18px}
    .brand a{display:flex;align-items:center;gap:12px;height:52px;text-decoration:none;color:var(--white)}
    .brand img{width:34px;height:34px}
    .brand span{font-size:24px;color:var(--white);font-weight:400}

    .nav{display:flex;flex-direction:column;gap:10px;margin-top:6px}
    .nav a{
      text-decoration:none;color:var(--muted);display:flex;align-items:center;gap:16px;
      padding:16px 18px;border-radius:16px;border:1px solid transparent;transition:border-color .2s ease;
      font-size:19px;
    }
    .nav a img.icon{width:30px;height:30px;opacity:.95}
    .nav a img.arr{width:20px;height:20px;opacity:.9}
    .nav a.active{background:#181620;border:1px solid var(--border);color:var(--white)}
    .nav a:hover{background:transparent;border-color:var(--border);color:var(--white)}
    .nav a.active:hover{background:#181620;border-color:var(--border)}

    .push{flex:1}
    .end-only{display:none;opacity:0;transform:translateY(8px)}
    .legal,.copy,.copy2{color:var(--muted);font-size:15px;line-height:1.6}
    .footer-sep{height:1px;background:var(--border);margin:10px 0}

    /* ===== MAIN ===== */
    .main{padding:0 20px 140px;display:grid;grid-template-rows:auto auto 1fr;gap:var(--gap)}
    .topbar{
      position:sticky;top:0;z-index:5;background:var(--bg);
      display:flex;align-items:flex-end;justify-content:space-between;padding:8px 6px 10px;
      height:64px;border-bottom:1px solid var(--border);
    }
    .top-left{display:flex;align-items:center;gap:12px}
    .top-title{font-size:20px;color:var(--white);font-weight:400}

    /* Doc title row (under topbar) */
    .doc-title{
      padding:6px 6px 0 6px; display:flex; align-items:baseline; gap:10px; flex-wrap:wrap;
    }
    .doc-title .label{color:var(--white);opacity:.9;font-weight:400;letter-spacing:.2px}
    .doc-title .name{color:var(--white);font-weight:400}
    @media (min-width:700px){
      .doc-title .label{font-size:24px}
      .doc-title .name{font-size:28px}
    }
    @media (max-width:699px){
      .doc-title .label{font-size:20px}
      .doc-title .name{font-size:24px}
    }

    /* Language control */
    .lang{position:relative}
    .lang-btn{
      display:flex;align-items:center;gap:8px;background:transparent;border:none;color:var(--white);
      font:400 20px/1 Inter;cursor:pointer;padding:6px 10px;min-width:40px;user-select:none
    }
    .lang-btn #langNow{letter-spacing:.6px}
    .lang-btn .caret{width:0;height:0;border-left:6px solid transparent;border-right:6px solid transparent;border-top:7px solid #fff;opacity:.9}
    .lang-menu{
      position:absolute;right:0;top:calc(100% + 8px);background:var(--card);border:1px solid var(--border);
      border-radius:12px;min-width:240px;max-height:240px;overflow:auto;display:none;box-shadow:0 10px 30px rgba(0,0,0,.4);padding:6px;
      scrollbar-width:thin;scrollbar-color:#6a6a6a transparent;
    }
    /* keep open on hover OR when .open is set (mobile click toggles) */
    .lang:hover .lang-menu, .lang.open .lang-menu{display:block}
    .lang-menu::-webkit-scrollbar{width:6px}
    .lang-menu::-webkit-scrollbar-thumb{background:#6a6a6a;border-radius:10px}
    .lang-item{display:flex;align-items:center;gap:8px;padding:10px;border-radius:10px;color:var(--white);cursor:pointer}
    .lang-item:hover{background:#17161e}

    /* Grid */
    .grid{
      display:grid;
      grid-template-columns:minmax(560px,1.25fr) minmax(560px,1fr);
      gap:var(--gap);
      align-items:start;
      margin-top:6px;
    }
    .left,.right{display:flex;flex-direction:column;gap:var(--gap)}

    /* Fade-in */
    @keyframes fadeIn{to{opacity:1;transform:translateY(0)}}
    .fade-in{animation:fadeIn .8s ease forwards}
    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:18px 18px 20px;opacity:0;transform:translateY(8px)}
    .card h3{margin:0 0 16px;display:flex;align-items:center;gap:12px;font-size:24px;color:var(--white);font-weight:400}
    .card h3 img{width:30px;height:30px}

    /* Text blocks */
    .list{display:flex;flex-direction:column;gap:16px}
    .list p{margin:0;color:var(--muted);font-size:20px;overflow-wrap:anywhere;word-break:break-word}

    /* Heights when empty */
    #summaryText:empty{min-height:72px}
    #issuesList:empty{min-height:72px}
    #suggestionsList:empty{min-height:72px}
    #clausesList:empty{min-height:72px}
    #riskNote:empty,#clarNote:empty{min-height:24px}
    #scoreCard .score-remark:empty{min-height:40px}

    /* Bullets (Issues) */
    .bullets{margin:0;color:var(--muted);font-size:20px;padding-left:22px;list-style:disc}
    .bullets li{margin:0 0 12px}

    /* Numbered lists (Main Clauses / Suggestions) -> 1. 2. 3. 4. 5. */
    .numbered{counter-reset:item}
    .numbered p{position:relative;padding-left:26px}
    .numbered p::before{counter-increment:item;content:counter(item) ".";position:absolute;left:0;top:0;color:var(--muted)}

    /* Meters */
    .meter-block{display:flex;flex-direction:column;gap:10px}
    .meter-head{display:flex;align-items:center;justify-content:space-between}
    .meter-title{display:flex;align-items:center;gap:12px;font-size:22px}
    .meter-title img{width:32px;height:32px}
    .meter{height:10px;border-radius:999px;background:var(--black);overflow:hidden}
    .fill{height:100%;width:0%;transition:width 1.6s ease;border-radius:999px}

    /* Donuts */
    .hcard{display:flex;gap:16px;align-items:center}
    .circle{width:160px;height:160px;position:relative;display:grid;place-items:center;flex:0 0 160px}
    .circle svg{transform:rotate(-90deg)}
    .circle .val{position:absolute;font-weight:400;font-size:34px;color:var(--white)}
    .circle circle.track{stroke:var(--black);stroke-width:12;fill:none}
    .circle circle.arc{stroke-width:12;fill:none;stroke-linecap:round;stroke-dasharray:440;stroke-dashoffset:440}
    .htext{flex:1;display:flex;flex-direction:column;gap:8px}
    .muted{color:var(--muted);font-size:18px}
    .status{display:flex;align-items:center;gap:8px;margin-top:8px}
    .status .dot{width:10px;height:10px;border-radius:2px;background:var(--green)}
    .status span{font-size:17px;color:var(--white);font-weight:400}

    /* Score Checker */
    #scoreCard{margin-top:12px;}
    #confRightCard{margin-top:12px;}
    #summaryCard,#riskCard,#clarCard,#profCard,#favCard,#deadCard,#issuesCard,#clausesCard,#suggestionsCard,#scoreCard,#confRightCard{will-change:transform,opacity}
    #scoreCard .score-center{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;text-align:center}
    #scoreCard .score-pct{font-size:42px}
    .score-side{flex:1;display:flex;flex-direction:column;gap:14px}
    .score-remark{font-size:20px;color:var(--muted)}
    .score-bar{position:relative;height:22px;border-radius:14px;background:linear-gradient(90deg,#ff6b6b 0%, #ffd166 45%, #00e676 100%);border:1px solid #2f2f2f;box-shadow:inset 0 1px 0 rgba(255,255,255,.05);width:100%}
    .score-ind{position:absolute;top:-6px;height:34px;width:3px;background:#fff;border-radius:2px;left:calc(80% - 1.5px);box-shadow:0 0 8px rgba(255,255,255,.6)}
    .score-scale{display:flex;justify-content:space-between;font-size:16px;color:var(--muted)}

    .scroll-y{max-height:none !important;overflow:visible !important}
    .download-wrap{position:fixed;left:var(--sidebar);right:0;bottom:34px;display:none;justify-content:center;z-index:9;opacity:0;transform:translateY(8px)}
    .download{background:#f2f9fe;color:#000;border:1px solid #cfcfcf;border-radius:16px;padding:18px 32px;display:inline-flex;gap:12px;align-items:center;cursor:pointer;font-weight:400;font-size:19px;box-shadow:0 6px 28px rgba(0,0,0,.28)}
    .download:hover{filter:brightness(1.03)}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:20}
    .modal-card{background:#141319;border:1px solid var(--border);border-radius:18px;padding:18px 18px 16px;width:min(480px,92vw)}
    .modal-card h4{margin:0 0 10px;font-size:18px;font-weight:400}
    .modal-row{display:flex;gap:10px;margin-top:12px}
    .input{flex:1;background:#0f0e14;border:1px solid #5a5a5a;border-radius:10px;padding:12px;color:#fff;font:400 15px/1 Inter}
    .btn{background:#0f0e14;border:1px solid var(--border);color:#fff;border-radius:10px;padding:12px 14px;cursor:pointer}
    .btn.primary{background:#f2f9fe;color:#000;border-color:#cfcfcf}

    @media (max-width:1100px){
      .layout{grid-template-columns:1fr}
      .download-wrap{left:0}
      .grid{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="layout">
    <!-- ===== SIDEBAR ===== -->
    <aside class="sidebar">
      <div class="brand">
        <a href="index.html" aria-label="Go to homepage">
          <img src="https://imgur.com/Z5hv7K9.png" alt="SignSense logo">
          <span>SignSense</span>
        </a>
      </div>

      <nav class="nav">
        <a class="active" href="#">
          <img class="arr" src="https://imgur.com/CHGomYz.png" alt="">
          <img class="icon" src="https://imgur.com/lnQTDuo.png" alt="">
          <span>Overview</span>
        </a>
        <a href="index.html"><img class="arr" src="https://imgur.com/xhkeG0y.png" alt=""><img class="icon" src="https://imgur.com/kE3okdE.png" alt=""><span>Home</span></a>
        <a href="privacy.html"><img class="arr" src="https://imgur.com/xhkeG0y.png" alt=""><img class="icon" src="https://imgur.com/krMnFVT.png" alt=""><span>Privacy</span></a>
        <a href="#"><img class="arr" src="https://imgur.com/xhkeG0y.png" alt=""><img class="icon" src="https://imgur.com/6zHviT6.png" alt=""><span>Contact Us</span></a>
        <a href="#" id="leaveReview"><img class="arr" src="https://imgur.com/xhkeG0y.png" alt=""><img class="icon" src="https://imgur.com/zwr9SOe.png" alt=""><span>Leave a Review</span></a>
      </nav>

      <div class="push"></div>
      <div class="end-only" id="sidebarEnd">
        <div class="legal">All rights reserved.</div>
        <div class="copy2">© 2025 SignSense</div>
        <div class="footer-sep"></div>
        <div class="copy">Not legal advice.<br/>For informational use only.</div>
      </div>
    </aside>

    <!-- ===== MAIN ===== -->
    <main class="main">
      <div class="topbar">
        <div class="top-left"><div class="top-title" id="overviewLabel">Overview</div></div>
        <div class="lang" id="lang">
          <button class="lang-btn" id="langBtn" type="button">
            <span id="langNow">EN</span>
            <span class="caret" aria-hidden="true"></span>
          </button>
          <div class="lang-menu" id="langMenu" role="listbox" aria-label="Report Language">
            <!-- Use data-code for switching; label is native -->
            <div class="lang-item" data-code="en">English</div>
            <div class="lang-item" data-code="it">Italiano</div>
            <div class="lang-item" data-code="de">Deutsch</div>
            <div class="lang-item" data-code="es">Español</div>
            <div class="lang-item" data-code="fr">Français</div>
            <div class="lang-item" data-code="pt">Português</div>
            <div class="lang-item" data-code="nl">Nederlands</div>
            <div class="lang-item" data-code="ro">Română</div>
            <div class="lang-item" data-code="sq">Shqip</div>
            <div class="lang-item" data-code="tr">Türkçe</div>
            <div class="lang-item" data-code="zh">中文</div>
            <div class="lang-item" data-code="ja">日本語</div>
          </div>
        </div>
      </div>

      <!-- Contract Title Row -->
      <div class="doc-title">
        <span class="label" id="titleWord">Title:</span>
        <span class="name" id="contractTitle">—</span>
      </div>

      <div class="grid">
        <!-- LEFT -->
        <div class="left">
          <section class="card" id="summaryCard">
            <h3><img src="https://imgur.com/CuQFbD7.png" alt=""><span id="hSummary">Summary</span></h3>
            <div class="list" id="summaryText"></div>
          </section>

          <section class="card meter-block" id="profCard">
            <div class="meter-head">
              <div class="meter-title"><img src="https://imgur.com/EdMAMnx.png" alt=""> <span id="hProfessionalism">Professionalism</span></div>
              <div id="confVal">0%</div>
            </div>
            <div class="meter"><div id="confFill" class="fill"></div></div>
          </section>

          <section class="card meter-block" id="favCard">
            <div class="meter-head">
              <div class="meter-title"><img src="https://imgur.com/UDRuIvO.png" alt=""> <span id="hFavorability">Favorability Index</span></div>
              <div id="favVal">0%</div>
            </div>
            <div class="meter"><div id="favFill" class="fill"></div></div>
          </section>

          <section class="card meter-block" id="deadCard">
            <div class="meter-head">
              <div class="meter-title"><img src="https://imgur.com/VXZ3kD8.png" alt=""> <span id="hDeadline">Deadline pressure</span></div>
              <div id="deadVal">0%</div>
            </div>
            <div class="meter"><div id="deadFill" class="fill"></div></div>
          </section>

          <section class="card" id="issuesCard">
            <h3><img src="https://imgur.com/ppLDtiq.png" alt=""><span id="hIssues">Potential Issues</span></h3>
            <ul class="bullets" id="issuesList"></ul>
          </section>

          <section class="card" id="suggestionsCard">
            <h3><img src="https://imgur.com/EoVDfd5.png" alt=""><span id="hSuggestions">Smart Suggestions</span></h3>
            <div class="list numbered" id="suggestionsList"></div>
          </section>
        </div>

        <!-- RIGHT -->
        <div class="right">
          <!-- Risk -->
          <section class="card" id="riskCard">
            <div class="hcard">
              <div class="circle">
                <svg width="160" height="160" viewBox="0 0 160 160">
                  <circle class="track" cx="80" cy="80" r="74"></circle>
                  <circle id="riskArc" class="arc" cx="80" cy="80" r="74"></circle>
                </svg>
                <div class="val" id="riskVal">0%</div>
              </div>
              <div class="htext">
                <h3 style="margin-bottom:0"><img src="https://imgur.com/Myp6Un4.png" alt=""><span id="hRisk">Risk Level</span></h3>
                <div class="muted" id="riskNote"></div>
                <div class="status"><span class="dot" id="riskDot"></span><span id="riskBadge">—</span></div>
              </div>
            </div>
          </section>

          <!-- Clarity -->
          <section class="card" id="clarCard">
            <div class="hcard">
              <div class="circle">
                <svg width="160" height="160" viewBox="0 0 160 160">
                  <circle class="track" cx="80" cy="80" r="74"></circle>
                  <circle id="clarArc" class="arc" cx="80" cy="80" r="74"></circle>
                </svg>
                <div class="val" id="clarVal">0%</div>
              </div>
              <div class="htext">
                <h3 style="margin-bottom:0"><img src="https://imgur.com/o39xZtC.png" alt=""><span id="hClarity">Clause Clarity</span></h3>
                <div class="muted" id="clarNote"></div>
                <div class="status"><span class="dot" id="clarDot"></span><span id="clarBadge">—</span></div>
              </div>
            </div>
          </section>

          <!-- Clauses -->
          <section class="card" id="clausesCard">
            <h3><img src="https://imgur.com/K04axKU.png" alt=""><span id="hClauses">Main Clauses</span></h3>
            <div class="list numbered" id="clausesList"></div>
          </section>

          <!-- Score Checker -->
          <section class="card" id="scoreCard">
            <div class="hcard">
              <div class="circle">
                <svg width="160" height="160" viewBox="0 0 160 160">
                  <circle class="track" cx="80" cy="80" r="74"></circle>
                  <circle id="scoreArc" class="arc" cx="80" cy="80" r="74"></circle>
                </svg>
                <div class="score-center">
                  <div class="score-pct" id="scorePct">0%</div>
                </div>
              </div>

              <div class="score-side">
                <h3 style="margin-bottom:0"><img src="https://imgur.com/mFvyCj7.png" alt=""><span id="hScore">Score Checker</span></h3>

                <div class="score-remark" id="scoreRemark"></div>

                <div class="score-bar">
                  <span class="score-ind" id="scoreInd"></span>
                </div>
                <div class="score-scale">
                  <span id="scaleUnsafe">Unsafe</span>
                  <span id="scaleSafe">Safe</span>
                  <span id="scaleVerySafe">Very Safe</span>
                </div>
              </div>
            </div>
          </section>

          <!-- Confidence to sign freely -->
          <section class="card meter-block" id="confRightCard">
            <div class="meter-head">
              <div class="meter-title"><img src="https://imgur.com/nUGfg96.png" alt=""> <span id="hConfidence">Confidence to sign freely</span></div>
              <div id="conf2Val">0%</div>
            </div>
            <div class="meter"><div id="conf2Fill" class="fill"></div></div>
          </section>
        </div>
      </div>
    </main>
  </div>

  <!-- Download -->
  <div class="download-wrap" id="dlWrap">
    <button class="download" id="downloadBtn">Download Report</button>
  </div>

  <!-- Email modal -->
  <div class="modal" id="emailModal" aria-modal="true" role="dialog">
    <div class="modal-card">
      <h4 id="emailPrompt">Enter your email to download the PDF report</h4>
      <div class="modal-row">
        <input id="emailInput" class="input" type="email" inputmode="email" placeholder="you@example.com" />
        <button class="btn primary" id="emailSubmit">Download</button>
        <button class="btn" id="emailCancel">Cancel</button>
      </div>
      <div id="emailErr" style="color:#ff6b6b;font-size:13px;margin-top:8px;display:none">Please enter a valid email address.</div>
    </div>
  </div>

<script>
(() => {
  // ------- Supported UI languages
  const SUP = ["en","it","de","es","fr","pt","nl","ro","sq","tr","zh","ja"];
  const SHORT = { en:"EN", it:"IT", de:"DE", es:"ES", fr:"FR", pt:"PT", nl:"NL", ro:"RO", sq:"SQ", tr:"TR", zh:"ZH", ja:"JA" };

  // ------- UI translations (labels, remarks, badges)
  const I18N = {
    en:{ overview:"Overview", titleWord:"Title:", summary:"Summary",
         professionalism:"Professionalism", favorability:"Favorability Index", deadline:"Deadline pressure",
         issues:"Potential Issues", suggestions:"Smart Suggestions", risk:"Risk Level", clarity:"Clause Clarity",
         clauses:"Main Clauses", score:"Score Checker", confidence:"Confidence to sign freely",
         scaleUnsafe:"Unsafe", scaleSafe:"Safe", scaleVerySafe:"Very Safe",
         remarkGreen:"The contract is nearly perfectly done.",
         remarkOrange:"The contract is done well.",
         remarkRed:"The contract isn’t done well.",
         safeTot:"Totally safe", safeGen:"Generally safe", safeNot:"Not safe",
         emailPrompt:"Enter your email to download the PDF report",
         emailErr:"Please enter a valid email address.",
         download:"Download", cancel:"Cancel" },
    it:{ overview:"Panoramica", titleWord:"Titolo:", summary:"Sommario",
         professionalism:"Professionalità", favorability:"Indice di favorevolezza", deadline:"Pressione delle scadenze",
         issues:"Problemi potenziali", suggestions:"Suggerimenti intelligenti", risk:"Livello di rischio", clarity:"Chiarezza delle clausole",
         clauses:"Clausole principali", score:"Verifica punteggio", confidence:"Fiducia nel firmare liberamente",
         scaleUnsafe:"Rischioso", scaleSafe:"Sicuro", scaleVerySafe:"Molto sicuro",
         remarkGreen:"Il contratto è quasi perfetto.",
         remarkOrange:"Il contratto è fatto bene.",
         remarkRed:"Il contratto non è fatto bene.",
         safeTot:"Completamente sicuro", safeGen:"Generalmente sicuro", safeNot:"Non sicuro",
         emailPrompt:"Inserisci l’email per scaricare il PDF",
         emailErr:"Inserisci un indirizzo email valido.",
         download:"Scarica", cancel:"Annulla" },
    de:{ overview:"Übersicht", titleWord:"Titel:", summary:"Zusammenfassung",
         professionalism:"Professionalität", favorability:"Günstigkeitsindex", deadline:"Termindruck",
         issues:"Mögliche Probleme", suggestions:"Smarte Vorschläge", risk:"Risikostufe", clarity:"Klarheit der Klauseln",
         clauses:"Hauptklauseln", score:"Score-Prüfer", confidence:"Zuversicht frei zu unterschreiben",
         scaleUnsafe:"Riskant", scaleSafe:"Sicher", scaleVerySafe:"Sehr sicher",
         remarkGreen:"Der Vertrag ist nahezu perfekt.",
         remarkOrange:"Der Vertrag ist gut gemacht.",
         remarkRed:"Der Vertrag ist nicht gut gemacht.",
         safeTot:"Völlig sicher", safeGen:"Generell sicher", safeNot:"Nicht sicher",
         emailPrompt:"E-Mail eingeben, um den PDF-Bericht zu laden",
         emailErr:"Bitte eine gültige E-Mail eingeben.",
         download:"Herunterladen", cancel:"Abbrechen" },
    es:{ overview:"Resumen", titleWord:"Título:", summary:"Resumen",
         professionalism:"Profesionalidad", favorability:"Índice de favorabilidad", deadline:"Presión de plazos",
         issues:"Problemas potenciales", suggestions:"Sugerencias inteligentes", risk:"Nivel de riesgo", clarity:"Claridad de las cláusulas",
         clauses:"Cláusulas principales", score:"Comprobador de puntuación", confidence:"Confianza para firmar libremente",
         scaleUnsafe:"Riesgoso", scaleSafe:"Seguro", scaleVerySafe:"Muy seguro",
         remarkGreen:"El contrato está casi perfecto.",
         remarkOrange:"El contrato está bien hecho.",
         remarkRed:"El contrato no está bien hecho.",
         safeTot:"Totalmente seguro", safeGen:"Generalmente seguro", safeNot:"No seguro",
         emailPrompt:"Escribe tu email para descargar el PDF",
         emailErr:"Introduce un email válido.",
         download:"Descargar", cancel:"Cancelar" },
    fr:{ overview:"Aperçu", titleWord:"Titre :", summary:"Résumé",
         professionalism:"Professionnalisme", favorability:"Indice de favorabilité", deadline:"Pression des délais",
         issues:"Problèmes potentiels", suggestions:"Suggestions intelligentes", risk:"Niveau de risque", clarity:"Clarté des clauses",
         clauses:"Clauses principales", score:"Vérificateur de score", confidence:"Confiance pour signer librement",
         scaleUnsafe:"Risque", scaleSafe:"Sûr", scaleVerySafe:"Très sûr",
         remarkGreen:"Le contrat est presque parfait.",
         remarkOrange:"Le contrat est bien réalisé.",
         remarkRed:"Le contrat n’est pas bien réalisé.",
         safeTot:"Totalement sûr", safeGen:"Généralement sûr", safeNot:"Pas sûr",
         emailPrompt:"Entrez votre e-mail pour télécharger le PDF",
         emailErr:"Veuillez entrer une adresse e-mail valide.",
         download:"Télécharger", cancel:"Annuler" },
    pt:{ overview:"Visão geral", titleWord:"Título:", summary:"Resumo",
         professionalism:"Profissionalismo", favorability:"Índice de favorabilidade", deadline:"Pressão de prazo",
         issues:"Problemas potenciais", suggestions:"Sugestões inteligentes", risk:"Nível de risco", clarity:"Clareza das cláusulas",
         clauses:"Cláusulas principais", score:"Verificador de pontuação", confidence:"Confiança para assinar livremente",
         scaleUnsafe:"Arriscado", scaleSafe:"Seguro", scaleVerySafe:"Muito seguro",
         remarkGreen:"O contrato está quase perfeito.",
         remarkOrange:"O contrato está bem feito.",
         remarkRed:"O contrato não está bem feito.",
         safeTot:"Totalmente seguro", safeGen:"Geralmente seguro", safeNot:"Não seguro",
         emailPrompt:"Digite seu e-mail para baixar o PDF",
         emailErr:"Insira um e-mail válido.",
         download:"Baixar", cancel:"Cancelar" },
    nl:{ overview:"Overzicht", titleWord:"Titel:", summary:"Samenvatting",
         professionalism:"Professionaliteit", favorability:"Voordeligheidsindex", deadline:"Deadline-druk",
         issues:"Mogelijke problemen", suggestions:"Slimme suggesties", risk:"Risiconiveau", clarity:"Duidelijkheid van clausules",
         clauses:"Belangrijkste clausules", score:"Score-controle", confidence:"Vertrouwen om vrij te tekenen",
         scaleUnsafe:"Onveilig", scaleSafe:"Veilig", scaleVerySafe:"Zeer veilig",
         remarkGreen:"Het contract is bijna perfect.",
         remarkOrange:"Het contract is goed gedaan.",
         remarkRed:"Het contract is niet goed gedaan.",
         safeTot:"Volledig veilig", safeGen:"Over het algemeen veilig", safeNot:"Onveilig",
         emailPrompt:"Voer je e-mail in om de PDF te downloaden",
         emailErr:"Voer een geldig e-mailadres in.",
         download:"Downloaden", cancel:"Annuleren" },
    ro:{ overview:"Prezentare", titleWord:"Titlu:", summary:"Rezumat",
         professionalism:"Profesionalism", favorability:"Indice de favorabilitate", deadline:"Presiune pe termen",
         issues:"Probleme potențiale", suggestions:"Sugestii inteligente", risk:"Nivel de risc", clarity:"Claritatea clauzelor",
         clauses:"Clauze principale", score:"Verificator scor", confidence:"Încredere pentru a semna liber",
         scaleUnsafe:"Riscant", scaleSafe:"Sigur", scaleVerySafe:"Foarte sigur",
         remarkGreen:"Contractul este aproape perfect.",
         remarkOrange:"Contractul este bine făcut.",
         remarkRed:"Contractul nu este bine făcut.",
         safeTot:"Total sigur", safeGen:"În general sigur", safeNot:"Nesigur",
         emailPrompt:"Introduceți emailul pentru a descărca PDF-ul",
         emailErr:"Introduceți un email valid.",
         download:"Descarcă", cancel:"Anulează" },
    sq:{ overview:"Përmbledhje", titleWord:"Titulli:", summary:"Rezumé",
         professionalism:"Profesionalizëm", favorability:"Indeksi i favorshmërisë", deadline:"Presioni i afateve",
         issues:"Çështje potenciale", suggestions:"Sugjerime të zgjuara", risk:"Niveli i rrezikut", clarity:"Qartësia e klauzolave",
         clauses:"Klauzolat kryesore", score:"Kontrolli i pikëve", confidence:"Besimi për të firmosur lirshëm",
         scaleUnsafe:"E pasigurt", scaleSafe:"E sigurt", scaleVerySafe:"Shumë e sigurt",
         remarkGreen:"Kontrata është pothuajse perfekte.",
         remarkOrange:"Kontrata është bërë mirë.",
         remarkRed:"Kontrata nuk është bërë mirë.",
         safeTot:"Tërësisht e sigurt", safeGen:"Në përgjithësi e sigurt", safeNot:"Jo e sigurt",
         emailPrompt:"Shkruaj emailin për të shkarkuar PDF-në",
         emailErr:"Shkruaj një email të vlefshëm.",
         download:"Shkarko", cancel:"Anulo" },
    tr:{ overview:"Genel bakış", titleWord:"Başlık:", summary:"Özet",
         professionalism:"Profesyonellik", favorability:"Lehterlik endeksi", deadline:"Zaman baskısı",
         issues:"Olası sorunlar", suggestions:"Akıllı öneriler", risk:"Risk düzeyi", clarity:"Madde açıklığı",
         clauses:"Ana maddeler", score:"Skor denetleyici", confidence:"Özgürce imzalama güveni",
         scaleUnsafe:"Riskli", scaleSafe:"Güvenli", scaleVerySafe:"Çok güvenli",
         remarkGreen:"Sözleşme neredeyse kusursuz.",
         remarkOrange:"Sözleşme iyi hazırlanmış.",
         remarkRed:"Sözleşme iyi hazırlanmış değil.",
         safeTot:"Tamamen güvenli", safeGen:"Genel olarak güvenli", safeNot:"Güvenli değil",
         emailPrompt:"PDF indirmek için e-posta girin",
         emailErr:"Geçerli bir e-posta girin.",
         download:"İndir", cancel:"İptal" },
    zh:{ overview:"概览", titleWord:"标题：", summary:"摘要",
         professionalism:"专业度", favorability:"有利指数", deadline:"截止压力",
         issues:"潜在问题", suggestions:"智能建议", risk:"风险等级", clarity:"条款清晰度",
         clauses:"主要条款", score:"评分检查", confidence:"自由签署的信心",
         scaleUnsafe:"不安全", scaleSafe:"安全", scaleVerySafe:"非常安全",
         remarkGreen:"合同几乎完美。",
         remarkOrange:"合同完成得很好。",
         remarkRed:"合同完成得不佳。",
         safeTot:"完全安全", safeGen:"总体安全", safeNot:"不安全",
         emailPrompt:"输入邮箱以下载PDF报告",
         emailErr:"请输入有效的邮箱地址。",
         download:"下载", cancel:"取消" },
    ja:{ overview:"概要", titleWord:"タイトル：", summary:"要約",
         professionalism:"プロフェッショナリズム", favorability:"有利性指数", deadline:"期限プレッシャー",
         issues:"潜在的な問題", suggestions:"スマート提案", risk:"リスクレベル", clarity:"条項の明確さ",
         clauses:"主要条項", score:"スコアチェッカー", confidence:"自由に署名できる自信",
         scaleUnsafe:"危険", scaleSafe:"安全", scaleVerySafe:"非常に安全",
         remarkGreen:"契約はほぼ完璧です。",
         remarkOrange:"契約はよく仕上がっています。",
         remarkRed:"契約はうまく仕上がっていません。",
         safeTot:"完全に安全", safeGen:"概ね安全", safeNot:"安全ではない",
         emailPrompt:"PDFレポートをダウンロードするにはメールを入力",
         emailErr:"有効なメールアドレスを入力してください。",
         download:"ダウンロード", cancel:"キャンセル" },
  };

  // ------- Helpers
  const $ = s => document.querySelector(s);
  const cssVar = v => getComputedStyle(document.documentElement).getPropertyValue(v).trim();
  const between = (v,min,max)=>Math.max(min,Math.min(Number(v)||0,max));
  const addP = (el, t)=>{const p=document.createElement('p');p.textContent=String(t||"");el.appendChild(p);};
  function colorFor(metric, v){
    if (metric === 'risk')     { if (v<=25) return cssVar('--green'); if (v<=58) return cssVar('--orange'); return cssVar('--red'); }
    if (metric === 'clarity')  { if (v>=78) return cssVar('--green'); if (v>=49) return cssVar('--orange'); return cssVar('--red'); }
    if (metric === 'deadline') { if (v<=35) return cssVar('--green'); if (v<=68) return cssVar('--orange'); return cssVar('--red'); }
    if (v>=75) return cssVar('--green'); if (v>=49) return cssVar('--orange'); return cssVar('--red');
  }
  function bandFor(metric, v){
    if (metric==='risk')     return (v<=25) ? 'green' : (v<=58) ? 'orange' : 'red';
    if (metric==='clarity')  return (v>=78) ? 'green' : (v>=49) ? 'orange' : 'red';
    return 'green';
  }
  function setArc(arcEl, metric, value, valEl, noteEl, note){
    const v = between(value||0, 0, 100);
    const rr = parseFloat(arcEl.getAttribute('r')) || 74;
    const circ = 2*Math.PI*rr;
    arcEl.style.stroke = colorFor(metric, v);
    arcEl.style.strokeDasharray = String(circ);
    arcEl.style.strokeDashoffset = String(circ);
    requestAnimationFrame(()=>{ arcEl.style.transition="stroke-dashoffset 1.6s ease"; arcEl.style.strokeDashoffset = String(circ * (1 - v/100)); });
    if (valEl) valEl.textContent = v + "%";
    if (noteEl) noteEl.textContent = note || "";
  }
  function setMeter(fill, label, metric, value){
    const v = between(value||0, 0, 100);
    label.textContent = v + "%";
    fill.style.background = colorFor(metric, v);
    requestAnimationFrame(()=>{ fill.style.width = v + "%"; });
  }

  // ------- Load payload from analyze step (live) or fallback
  const mode = localStorage.getItem("analysisMode");
  let payload = {};
  if (mode === "live") {
    try { payload = JSON.parse(localStorage.getItem("analysisRaw") || "{}"); } catch {}
  }
  // graceful defaults
  const analysis = payload.analysis || {};
  const toArr = (v) => Array.isArray(v) ? v : (v ? String(v).split(/\n{2,}|\n/g).filter(Boolean) : []);

  // Base report (original language)
  const base = {
    contractTitle: payload.contractTitle || payload.contractName || "Contract",
    detectedLang: (payload.detectedLang || "en").toLowerCase(),
    summary: toArr(analysis.summary).slice(0,4),
    risk: { value: Number(analysis?.risk?.value ?? 0), note: analysis?.risk?.note || "" },
    clarity: { value: Number(analysis?.clarity?.value ?? 0), note: analysis?.clarity?.note || "" },
    clauses: (analysis.mainClauses || []).slice(0,5),
    issues: (analysis.potentialIssues || []).slice(0,5),
    suggestions: (analysis.smartSuggestions || []).slice(0,3),
    bars: {
      professionalism: Number(analysis?.bars?.professionalism ?? 0),
      favorability:    Number(analysis?.bars?.favorabilityIndex ?? 0),
      deadline:        Number(analysis?.bars?.deadlinePressure ?? 0),
      confidence:      Number(analysis?.bars?.confidenceToSign ?? 0),
    },
    score: {
      value: Number(analysis?.scoreChecker?.value ?? 0),
      band: analysis?.scoreChecker?.band || null
    },
    translations: payload.translations || {}
  };

  // Decide initial UI language
  const storedLang = (localStorage.getItem("uiLang")||"").toLowerCase();
  let currentLang = SUP.includes(storedLang) ? storedLang : (SUP.includes(base.detectedLang) ? base.detectedLang : "en");

  // Build the report content for a target UI lang
  function reportFor(lang){
    const t = base.translations?.[lang] || {};
    return {
      title: base.contractTitle,
      summary: toArr(t.summary).length ? toArr(t.summary).slice(0,4) : base.summary,
      clauses: Array.isArray(t.mainClauses) && t.mainClauses.length ? t.mainClauses.slice(0,5) : base.clauses,
      issues: Array.isArray(t.potentialIssues) && t.potentialIssues.length ? t.potentialIssues.slice(0,5) : base.issues,
      suggestions: Array.isArray(t.smartSuggestions) && t.smartSuggestions.length ? t.smartSuggestions.slice(0,3) : base.suggestions,
      // risk/clarity notes: use translated note if present; else original
      riskNote: (t.riskNote || base.risk.note || ""),
      clarityNote: (t.clarityNote || base.clarity.note || ""),
      riskVal: base.risk.value,
      clarityVal: base.clarity.value,
      bars: base.bars,
      scoreVal: base.score.value
    };
  }

  // UI text swap
  function setUIStrings(lang){
    const L = I18N[lang] || I18N.en;
    $("#overviewLabel").textContent = L.overview;
    $("#titleWord").textContent = L.titleWord;
    $("#hSummary").textContent = L.summary;
    $("#hProfessionalism").textContent = L.professionalism;
    $("#hFavorability").textContent = L.favorability;
    $("#hDeadline").textContent = L.deadline;
    $("#hIssues").textContent = L.issues;
    $("#hSuggestions").textContent = L.suggestions;
    $("#hRisk").textContent = L.risk;
    $("#hClarity").textContent = L.clarity;
    $("#hClauses").textContent = L.clauses;
    $("#hScore").textContent = L.score;
    $("#hConfidence").textContent = L.confidence;
    $("#scaleUnsafe").textContent = L.scaleUnsafe;
    $("#scaleSafe").textContent = L.scaleSafe;
    $("#scaleVerySafe").textContent = L.scaleVerySafe;
    $("#emailPrompt").textContent = L.emailPrompt;
    $("#emailErr").textContent = L.emailErr;
    $("#emailSubmit").textContent = L.download;
    $("#emailCancel").textContent = L.cancel;
  }

  // Badges per band with translation
  function badgeText(lang, band, domain){ // domain risk|clarity (same wording)
    const L = I18N[lang] || I18N.en;
    if (band==='green') return L.safeTot;
    if (band==='orange') return L.safeGen;
    return L.safeNot;
  }

  // Render the whole page for a given lang
  function render(lang){
    currentLang = SUP.includes(lang) ? lang : "en";
    localStorage.setItem("uiLang", currentLang);
    $("#langNow").textContent = SHORT[currentLang] || "EN";
    setUIStrings(currentLang);

    const d = reportFor(currentLang);
    $("#contractTitle").textContent = d.title || "—";

    // Summary
    const sBox=$("#summaryText"); sBox.innerHTML="";
    (d.summary||[]).forEach(t=>addP(sBox,t));

    // Main Clauses
    (function(){ const el=$("#clausesList"); el.innerHTML=""; (d.clauses||[]).forEach(t=>addP(el,t)); })();

    // Issues
    (function(){ const el=$("#issuesList"); el.innerHTML=""; (d.issues||[]).forEach(t=>{const li=document.createElement('li'); li.textContent=t; el.appendChild(li);}); })();

    // Suggestions
    (function(){ const el=$("#suggestionsList"); el.innerHTML=""; (d.suggestions||[]).forEach(t=>addP(el,t)); })();

    // Donuts + notes + badges
    setArc($("#riskArc"), 'risk', d.riskVal, $("#riskVal"), $("#riskNote"), d.riskNote);
    setArc($("#clarArc"), 'clarity', d.clarityVal, $("#clarVal"), $("#clarNote"), d.clarityNote);

    // Badge colors and text based on band
    const rBand = bandFor('risk', d.riskVal);
    const cBand = bandFor('clarity', d.clarityVal);
    $("#riskDot").style.background = (rBand==='green')?cssVar('--green'):(rBand==='orange')?cssVar('--orange'):cssVar('--red');
    $("#clarDot").style.background = (cBand==='green')?cssVar('--green'):(cBand==='orange')?cssVar('--orange'):cssVar('--red');
    $("#riskBadge").textContent = badgeText(currentLang, rBand, 'risk');
    $("#clarBadge").textContent = badgeText(currentLang, cBand, 'clarity');

    // Bars
    setMeter($("#confFill"), $("#confVal"), 'professionalism', d.bars.professionalism);
    setMeter($("#favFill"),  $("#favVal"),  'favorability',    d.bars.favorability);
    setMeter($("#deadFill"), $("#deadVal"), 'deadline',        d.bars.deadline);
    setMeter($("#conf2Fill"), $("#conf2Val"), 'confidence',    d.bars.confidence);

    // Score checker (use clarity scale for color/remark)
    const v = between(d.scoreVal,0,100);
    setArc($("#scoreArc"), 'clarity', v);
    $("#scorePct").textContent = v + "%";
    $("#scoreInd").style.left = `calc(${v}% - 1.5px)`;
    const L = I18N[currentLang] || I18N.en;
    const remark = (v>=78) ? L.remarkGreen : (v>=49) ? L.remarkOrange : L.remarkRed;
    $("#scoreRemark").textContent = remark;
  }

  // ----- Initial reveal animations
  window.addEventListener('load', () => {
    ["#summaryCard","#riskCard","#clarCard"].forEach(sel => { const el=$(sel); if(el){el.classList.add('fade-in');}});
    setTimeout(()=>["#profCard","#favCard","#deadCard","#issuesCard","#clausesCard"].forEach(sel=>{const el=$(sel); if(el){el.classList.add('fade-in');}}), 180);
  });
  const io = new IntersectionObserver((entries)=>{ entries.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('fade-in'); io.unobserve(e.target);} });},{ threshold: .18 });
  ["#suggestionsCard","#scoreCard","#confRightCard"].forEach(sel=>{ const el=$(sel); if(el){ io.observe(el); } });

  // ----- Download button visibility & modal
  const dlWrap=$("#dlWrap"), endBox=$("#sidebarEnd");
  function nearBottom(){
    const scrolledFromBottom=document.documentElement.scrollHeight-(window.scrollY+window.innerHeight);
    const show=scrolledFromBottom<=300;
    dlWrap.style.display=show?"flex":"none";
    endBox.style.display=show?"block":"none";
    if(show){ dlWrap.classList.add('fade-in'); endBox.classList.add('fade-in'); }
  }
  window.addEventListener("scroll", nearBottom, {passive:true});
  window.addEventListener("load", nearBottom);

  const modal=$("#emailModal");
  const openModal=()=>modal.style.display="flex", closeModal=()=>modal.style.display="none";
  $("#downloadBtn").addEventListener("click", openModal);
  $("#emailCancel").addEventListener("click", closeModal);
  function validEmail(e){ return /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test((e||"").trim()); }
  $("#emailSubmit").addEventListener("click", async ()=>{
    const email=$("#emailInput").value||"", err=$("#emailErr");
    if(!validEmail(email)){ err.style.display="block"; return; }
    err.style.display="none";
    await generatePDF("Report", reportFor(currentLang)); // use current language content
    closeModal();
  });

  async function generatePDF(title, d){
    const { jsPDF } = window.jspdf;
    const doc=new jsPDF({ unit:"pt", format:"a4" });
    const pageW=doc.internal.pageSize.getWidth();
    const margin=48, width=pageW-margin*2, lh=18;

    // Header bar
    doc.setFillColor(28,27,34); doc.rect(0,0,pageW,80,'F');
    doc.setTextColor(255,255,255); doc.setFont("helvetica","normal"); doc.setFontSize(18);
    doc.text("SignSense — Contract Analysis Report", margin, 48);

    // Title
    const L = I18N[currentLang] || I18N.en;
    let y=100;
    doc.setFontSize(10); doc.setTextColor(189,189,189);
    doc.text(`Generated: ${new Date().toLocaleString()}`, margin, y); y+=lh*1.6;
    doc.setTextColor(255,255,255); doc.setFontSize(12);
    doc.text(`${L.titleWord} ${String(d.title||"")}`, margin, y); y+=lh*1.4;

    y=section(L.summary, y); y=bullets(d.summary, y);
    y=section(`${L.risk}: ${d.riskVal ?? 0}%`, y); y=paragraph(String(d.riskNote||""), y);
    y=section(`${L.clarity}: ${d.clarityVal ?? 0}%`, y); y=paragraph(String(d.clarityNote||""), y);
    y=section(L.clauses, y); y=bullets(d.clauses, y, true);
    y=section(L.issues, y); y=bullets(d.issues, y);
    y=section(L.suggestions, y); y=bullets(d.suggestions, y);
    doc.save("SignSense_Report.pdf");

    function section(t,y){ if(y>780){ doc.addPage(); y=64; } doc.setFont("helvetica","normal"); doc.setTextColor(255,255,255); doc.setFontSize(12); doc.text(String(t), margin, y); return y+12; }
    function paragraph(text,y){ if(!text) return y; doc.setFont("helvetica","normal"); doc.setTextColor(189,189,189); doc.setFontSize(11); let lines=doc.splitTextToSize(String(text),width); lines.forEach(line=>{ if(y>780){doc.addPage(); y=64;} doc.text(line, margin, y); y+=lh;}); return y; }
    function bullets(arr,y,numbered=false){
      const list=Array.isArray(arr)?arr:[]; doc.setFont("helvetica","normal"); doc.setTextColor(189,189,189); doc.setFontSize(11);
      let idx=1;
      list.forEach(t=>{
        const prefix = numbered ? (idx++ + ". ") : "• ";
        const lines=doc.splitTextToSize(prefix+String(t), width);
        lines.forEach((line,j)=>{ if(y>780){doc.addPage(); y=64;} doc.text(line, margin, y); y+=lh;});
      });
      return y;
    }
  }

  // ----- Language menu behavior: hover show; click toggles for mobile; persist choice
  const lang = $("#lang");
  // keep open while hovering (CSS does most); add click toggle for touch
  $("#langBtn").addEventListener("click", ()=>{ lang.classList.toggle("open"); });
  $("#langMenu").addEventListener("click", (e)=>{
    const item = e.target.closest(".lang-item");
    if(!item) return;
    const code = (item.getAttribute("data-code")||"en").toLowerCase();
    render(code);
    lang.classList.remove("open");
  });
  // close on outside click (mobile)
  document.addEventListener("click", (e)=>{
    if(!lang.contains(e.target)) lang.classList.remove("open");
  });

  // ----- Initial render
  render(currentLang);
})();
</script>
</body>
</html>
